---
phase: 12.1-scatter-mode
plan: 02
subsystem: ui
tags: [react-rnd, drag-and-drop, resize, freeform-layout, percentage-positioning]

# Dependency graph
requires:
  - phase: 12.1-01
    provides: scatter types, store actions, theme toggles
provides:
  - ScatterCanvas component with grid overlay and percentage conversion
  - ScatterCard component wrapping cards in react-rnd
  - Drag and resize functionality with bounds constraint
  - Z-index auto-increment on drag/resize
  - Custom resize handles with hover/selection visibility
  - Mobile touch support via touch-action: none
affects: [12.1-03-scatter-ui, 12.1-04-public-scatter, scatter-mode-integration]

# Tech tracking
tech-stack:
  added:
    - react-rnd: ^10.5.2
  patterns:
    - ResizeObserver for canvas dimension tracking
    - Percentage-to-pixel conversion on render, pixel-to-percentage on interaction
    - Bounds key pattern for forcing react-rnd recalculation on window resize
    - Custom resize handle styling with CSS visibility on hover/selection

key-files:
  created:
    - src/components/canvas/scatter-canvas.tsx
    - src/components/canvas/scatter-card.tsx
  modified:
    - src/app/globals.css
    - package.json

key-decisions:
  - "react-rnd for drag and resize - battle-tested, supports bounds and 8-direction resizing"
  - "ResizeObserver over window.addEventListener for accurate container dimension tracking"
  - "Bounds key increments on resize to force react-rnd bounds recalculation"
  - "Custom resize handle styling in globals.css with opacity-based visibility on hover/selection"

patterns-established:
  - "Canvas dimension tracking: ResizeObserver + local state for pixel width/height"
  - "Percentage conversion: percentX = (pixelX / canvasWidth) * 100"
  - "Z-index tracking: local maxZIndex state initialized from highest across all cards"
  - "Bounds recalculation: boundsKey in ScatterCard key forces remount on window resize"

# Metrics
duration: 2min
completed: 2026-02-11
---

# Phase 12.1-02: Scatter Grid Component Summary

**Core scatter canvas and card components with react-rnd for drag, resize, z-index, and percentage-based positioning**

## Performance

- **Duration:** 2 min
- **Started:** 2026-02-11T07:47:39Z
- **Completed:** 2026-02-11T07:49:39Z
- **Tasks:** 2
- **Files modified:** 4

## Accomplishments
- Installed react-rnd package for drag and resize functionality
- Created ScatterCard component wrapping CardRenderer in Rnd component
- Created ScatterCanvas container with ResizeObserver dimension tracking
- Implemented percentage-to-pixel conversion for rendering
- Implemented pixel-to-percentage conversion for drag/resize stop handlers
- Added 12x12 grid overlay with subtle white lines
- Custom resize handles (8 directions) with opacity-based visibility
- Blue ring selection indicator on selected cards
- Z-index auto-increment on drag start or resize start
- Bounds constraint prevents cards from leaving canvas
- Mobile touch support via touch-action: none
- Window resize triggers bounds recalculation via boundsKey increment

## Task Commits

Each task was committed atomically:

1. **Task 1: Install react-rnd and create ScatterCard component** - `87eeb2d` (feat)
2. **Task 2: Create ScatterCanvas container with grid overlay** - `2f84654` (feat)

## Files Created/Modified
- `src/components/canvas/scatter-card.tsx` - Rnd wrapper for individual cards with drag/resize, 8-direction resize handles, selection indicator, pixel-to-percentage conversion
- `src/components/canvas/scatter-canvas.tsx` - Canvas container with ResizeObserver, grid overlay, percentage conversion, z-index tracking, bounds recalculation
- `src/app/globals.css` - Added scatter resize handle styles (.scatter-resize-handle with hover/selection visibility)
- `package.json` - Added react-rnd: ^10.5.2

## Decisions Made

**1. react-rnd for drag and resize**
- Rationale: Battle-tested library with built-in bounds constraint, 8-direction resizing, and TypeScript types. Simpler than building custom drag/resize with dnd-kit.
- Implementation: Rnd component wraps CardRenderer, handles all drag/resize logic, provides callbacks with pixel coordinates.

**2. ResizeObserver over window.addEventListener**
- Rationale: More accurate than window resize events - tracks actual canvas container dimensions, handles split panel resizing.
- Implementation: ResizeObserver on canvasRef updates local canvasWidth/canvasHeight state.

**3. Bounds key pattern for window resize**
- Rationale: react-rnd doesn't automatically recalculate bounds on container resize. Incrementing key in ScatterCard forces remount and fresh bounds calculation.
- Implementation: boundsKey state increments in ResizeObserver callback, included in ScatterCard key prop.

**4. Custom resize handle styling**
- Rationale: Default react-rnd handles are plain divs. Custom styling makes them visible as blue circles with border, only on hover or when selected.
- Implementation: CSS classes (.scatter-resize-handle, .scatter-resize-handle-corner) with opacity transitions, show on .scatter-card:hover or .scatter-card.ring-2.

**5. Percentage-based storage with pixel-based display**
- Rationale: Storage in percentages enables responsive layouts, but react-rnd requires pixel values for positioning.
- Implementation: Convert percentages to pixels on render, convert pixels back to percentages in drag/resize stop handlers.

**6. Z-index tracking in local state**
- Rationale: Need to know highest z-index to bring dragged/resized cards to front. Calculate once from all cards, increment on interaction.
- Implementation: useEffect calculates maxZIndex from all cards' scatter positions for current theme, increment in handleBringToFront.

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

**Ready for scatter UI integration:**
- ScatterCanvas component complete (grid overlay, percentage conversion, z-index tracking)
- ScatterCard component complete (drag, resize, bounds, selection indicator)
- react-rnd installed and working
- Mobile touch support via touch-action: none
- Resize handles styled and visible on hover/selection

**Next phases can build:**
- Scatter mode toggle in editor UI
- Visitor drag functionality on public pages
- Database persistence for scatter layouts

**No blockers.** Core scatter canvas and card components ready for integration into editor preview.

---
*Phase: 12.1-scatter-mode*
*Completed: 2026-02-11*
