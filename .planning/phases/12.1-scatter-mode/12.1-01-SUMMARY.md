---
phase: 12.1-scatter-mode
plan: 01
subsystem: ui
tags: [zustand, typescript, scatter-layout, freeform-positioning, state-management]

# Dependency graph
requires:
  - phase: none
    provides: foundational types and store infrastructure
provides:
  - ScatterPosition type for freeform card positioning (x, y, width, height, zIndex as percentages)
  - SCATTER_THEMES constant defining 5 themes supporting scatter mode
  - Theme store scatter toggles (scatterMode, visitorDrag) with localStorage persistence
  - Page store scatter actions (updateCardScatterPosition, initializeScatterLayout)
  - Per-theme scatter layouts via card.content.scatterLayouts
affects: [12.1-02-scatter-grid, 12.1-03-scatter-ui, scatter-mode-ui-components]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - Per-theme layout storage pattern (card.content.scatterLayouts keyed by ThemeId)
    - Percentage-based positioning system (0-100 for responsive layouts)
    - Grid-based auto-initialization algorithm for scatter layout distribution

key-files:
  created:
    - src/types/scatter.ts
  modified:
    - src/types/theme.ts
    - src/stores/theme-store.ts
    - src/stores/page-store.ts

key-decisions:
  - "Scatter positions stored per-theme in card.content.scatterLayouts to support different layouts for each theme"
  - "Percentage-based positioning (0-100) for responsive layouts that scale with viewport"
  - "Grid-based auto-initialization distributes cards evenly when scatter mode first enabled"
  - "visitorDrag toggle auto-disables when scatterMode disabled (one-way dependency)"

patterns-established:
  - "Per-theme card configuration: card.content.{featureName}Layouts[themeId]"
  - "Scatter dimensions use percentages (0-100) for canvas-relative positioning"
  - "Store toggles follow pattern: setFeature(enabled) with dependent state cleanup"

# Metrics
duration: 3min
completed: 2026-02-11
---

# Phase 12.1-01: Scatter Mode Foundation Summary

**Type system and store actions for freeform card positioning across 5 themes with per-theme layout persistence**

## Performance

- **Duration:** 3 min
- **Started:** 2026-02-11T07:41:48Z
- **Completed:** 2026-02-11T07:44:47Z
- **Tasks:** 2
- **Files modified:** 4

## Accomplishments
- ScatterPosition type with percentage-based positioning (x, y, width, height, zIndex)
- SCATTER_THEMES constant defining 5 supported themes (mac-os, instagram-reels, system-settings, macintosh, word-art)
- Theme store scatter toggles with localStorage persistence (scatterMode, visitorDrag)
- Page store actions for updating individual card positions and initializing scatter layouts
- Grid-based auto-distribution algorithm for initial scatter layout

## Task Commits

Each task was committed atomically:

1. **Task 1: Create scatter types and constants** - `cc9f9f1` (feat)
2. **Task 2: Add scatter mode toggles to theme store and scatter actions to page store** - `ad1a017` (feat)

## Files Created/Modified
- `src/types/scatter.ts` - ScatterPosition interface, SCATTER_THEMES constant (5 themes), DEFAULT_SCATTER_SIZES per card type, isScatterTheme helper
- `src/types/theme.ts` - Added scatterMode and visitorDrag fields to ThemeState interface
- `src/stores/theme-store.ts` - Added scatterMode/visitorDrag state with setScatterMode/setVisitorDrag actions, localStorage persistence via existing persist middleware
- `src/stores/page-store.ts` - Added updateCardScatterPosition action (updates card.content.scatterLayouts[themeId]), initializeScatterLayout action (distributes cards in grid)

## Decisions Made

**1. Per-theme scatter layouts**
- Rationale: Different themes need different card arrangements (macOS desktop vs Instagram Reels feed). Storing layouts per-theme allows users to customize each theme independently.
- Implementation: card.content.scatterLayouts is a Partial<Record<ThemeId, ScatterPosition>>

**2. Percentage-based positioning**
- Rationale: Responsive layouts that work across viewport sizes require relative units, not pixels.
- Implementation: All ScatterPosition values (x, y, width, height) are percentages (0-100) of canvas dimensions.

**3. Grid-based auto-initialization**
- Rationale: When scatter mode is enabled for a theme, cards need sensible default positions (not all stacked at 0,0).
- Implementation: initializeScatterLayout calculates grid dimensions based on card count, distributes cards with spacing, centers each card in its grid cell.

**4. visitorDrag depends on scatterMode**
- Rationale: Visitor drag only makes sense when scatter mode is enabled. Disabling scatter mode should also disable visitor drag.
- Implementation: setScatterMode(false) automatically sets visitorDrag to false.

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

**Ready for scatter UI implementation:**
- Type system complete (ScatterPosition, ScatterLayouts, SCATTER_THEMES)
- Store foundation complete (theme toggles, page actions)
- Per-theme layout persistence working
- Grid-based initialization algorithm ready

**Next phases can build:**
- Scatter grid component (drag-and-drop, resize, z-index management)
- Scatter mode toggle UI (editor controls)
- Visitor drag functionality (public page interaction)

**No blockers.** All scatter mode data structures and state management in place.

---
*Phase: 12.1-scatter-mode*
*Completed: 2026-02-11*
