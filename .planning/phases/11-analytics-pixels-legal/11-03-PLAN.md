---
phase: 11-analytics-pixels-legal
plan: 03
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - src/components/analytics/metric-card.tsx
  - src/components/analytics/insights-chart.tsx
  - src/components/analytics/card-stats-table.tsx
  - src/components/editor/insights-tab.tsx
  - src/components/editor/editor-panel.tsx
autonomous: true

must_haves:
  truths:
    - "Artist can see unique visitors as the hero metric in the Insights tab"
    - "Artist can see total page views alongside unique visitors"
    - "Artist can see a time-series chart of views and visitors over time"
    - "Artist can see a ranked leaderboard of cards sorted by click count with CTR"
    - "Artist can filter all metrics by time period (7 days, 30 days, all time)"
    - "Empty state shows helpful message when no analytics data exists"
  artifacts:
    - path: "src/components/analytics/metric-card.tsx"
      provides: "Hero metric display component (unique visitors, total views)"
      min_lines: 20
    - path: "src/components/analytics/insights-chart.tsx"
      provides: "Time-series line chart using Recharts"
      min_lines: 40
    - path: "src/components/analytics/card-stats-table.tsx"
      provides: "Per-card leaderboard ranked by clicks with CTR"
      min_lines: 30
    - path: "src/components/editor/insights-tab.tsx"
      provides: "Insights tab container with data fetching and time filter"
      min_lines: 60
  key_links:
    - from: "src/components/editor/insights-tab.tsx"
      to: "/api/analytics/stats"
      via: "fetch GET with pageId and days params"
      pattern: "api/analytics/stats"
    - from: "src/components/editor/editor-panel.tsx"
      to: "src/components/editor/insights-tab.tsx"
      via: "InsightsTab rendered in Tabs"
      pattern: "InsightsTab|insights-tab"
---

<objective>
Build the Insights tab in the editor dashboard with analytics visualization: hero metrics (unique visitors, total views), time-series chart, and per-card click leaderboard with CTR. Includes time period filtering.

Purpose: Artists need to see their page performance at a glance. The Insights tab is where they understand which cards are working and how their audience is growing.
Output: Fully functional Insights tab with charts, metrics, and leaderboard.
</objective>

<execution_context>
@/Users/julianmunyard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/julianmunyard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-analytics-pixels-legal/11-RESEARCH.md
@.planning/phases/11-analytics-pixels-legal/11-01-SUMMARY.md
@src/components/editor/editor-panel.tsx
@src/app/api/analytics/stats/route.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Recharts and create analytics visualization components</name>
  <files>
    src/components/analytics/metric-card.tsx
    src/components/analytics/insights-chart.tsx
    src/components/analytics/card-stats-table.tsx
  </files>
  <action>
    1. Install recharts: `npm install recharts`
       - Note: recharts requires react-is as peer dep, install if needed: `npm install react-is`

    2. Create `src/components/analytics/metric-card.tsx`:
       - 'use client' component
       - Props: `label: string, value: number | string, description?: string, icon?: React.ReactNode`
       - Display as a card with the value prominently (text-3xl font-bold), label below (text-sm text-muted-foreground), optional icon top-right
       - Use existing shadcn Card component for container
       - Support loading state (skeleton placeholder when value is undefined)

    3. Create `src/components/analytics/insights-chart.tsx`:
       - 'use client' component
       - Props: `data: Array<{ date: string, views: number, visitors: number }>, isLoading: boolean`
       - Use Recharts: ResponsiveContainer (width 100%, height 280), AreaChart (area chart with gradient fill looks better than plain line for dashboards)
       - Two areas: "Unique Visitors" (primary/accent color) and "Total Views" (secondary/muted color)
       - XAxis: date formatted as "Jan 5", "Jan 6" etc. using short month + day
       - YAxis: auto-scale, hide on mobile (allowDecimals: false)
       - Tooltip: show date, visitors, views on hover
       - CartesianGrid: subtle dashed lines
       - Gradient fills for area charts (LinearGradient defs)
       - Loading state: show skeleton placeholder matching chart dimensions
       - Empty state: centered message "No data yet" with a subtle chart icon
       - Use theme-appropriate colors: read from CSS custom properties or use sensible defaults (#8b5cf6 purple for visitors, #6b7280 gray for views)

    4. Create `src/components/analytics/card-stats-table.tsx`:
       - 'use client' component
       - Props: `cards: Array<{ id: string, title: string, cardType: string, clicks: number, ctr: number }>, isLoading: boolean`
       - Render as a ranked list (not a traditional table - more visual):
         - Each row: rank number (#1, #2...), card title (truncated if long), card type badge, click count, CTR percentage
         - Top 3 cards get subtle highlight (e.g., gold/silver/bronze left border or background tint)
         - Card type shown as small badge (capitalize card_type)
       - If no clicks data: show "No clicks recorded yet" empty state
       - Loading state: 5 skeleton rows
       - Sort is already done by API (most clicks first)
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - recharts is in package.json
    - All three components export correctly
    - Components handle loading and empty states
  </verify>
  <done>
    MetricCard, InsightsChart, and CardStatsTable components are ready for use in the Insights tab. Each handles loading and empty states gracefully.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Insights tab and wire into editor panel</name>
  <files>
    src/components/editor/insights-tab.tsx
    src/components/editor/editor-panel.tsx
  </files>
  <action>
    1. Create `src/components/editor/insights-tab.tsx`:
       - 'use client' component
       - State: `days` (7 | 30 | 0, default 7), `stats` (analytics data), `isLoading`, `error`
       - On mount and when `days` changes, fetch /api/analytics/stats?pageId={pageId}&days={days}
       - Get pageId by fetching /api/page (same pattern used in settings-tab.tsx)
       - Layout (scrollable):
         a. **Time period filter**: ToggleGroup with three options: "7 Days", "30 Days", "All Time" - positioned at top right
         b. **Hero metrics row**: Two MetricCard components side by side
            - Primary (larger): Unique Visitors with Users icon
            - Secondary: Total Page Views with Eye icon
         c. **Time-series chart**: InsightsChart with the timeSeries data
         d. **Card leaderboard**: Section header "Top Performing Cards" with CardStatsTable
       - Error state: show error message with retry button
       - Empty state (no analytics at all): Friendly message like "Share your page to start seeing analytics" with an illustration or icon. Include the page URL for easy copying.
       - Use ScrollArea for the content area (consistent with other tabs)

    2. Modify `src/components/editor/editor-panel.tsx`:
       - Import InsightsTab and BarChart3 icon from lucide-react
       - Add a new tab between "Schedule" and "Settings":
         ```
         <TabsTrigger value="insights" className="flex-1 gap-2">
           <BarChart3 className="h-4 w-4" />
           <span className="hidden sm:inline">Insights</span>
         </TabsTrigger>
         ```
       - Add corresponding TabsContent:
         ```
         <TabsContent value="insights" className={cn("flex-1 overflow-hidden", "data-[state=inactive]:hidden")}>
           <InsightsTab />
         </TabsContent>
         ```
       - Keep the tab order as: Links, Design, Schedule, Insights, Settings
  </action>
  <verify>
    - `npx tsc --noEmit` passes
    - InsightsTab renders hero metrics, chart, and leaderboard
    - Editor panel has 5 tabs including Insights
    - Time period filter changes data displayed
    - `npm run build` succeeds
  </verify>
  <done>
    Insights tab is visible in the editor with hero metric (unique visitors), time-series chart, per-card leaderboard with CTR, and time period filtering (7d, 30d, all time).
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors
2. Insights tab appears in editor between Schedule and Settings
3. Hero metrics show unique visitors and total views
4. Area chart renders time-series data with proper formatting
5. Card leaderboard ranks cards by clicks with CTR percentages
6. Time period filter switches between 7 days, 30 days, all time
7. Empty state shows when no analytics data exists
8. Build succeeds with `npm run build`
</verification>

<success_criteria>
- Artist can view analytics dashboard with real data from tracking API
- Unique visitors is the hero metric (shown prominently)
- Per-card leaderboard shows which content performs best
- Time filtering works across all metrics and chart
- Loading and empty states provide good UX
</success_criteria>

<output>
After completion, create `.planning/phases/11-analytics-pixels-legal/11-03-SUMMARY.md`
</output>
