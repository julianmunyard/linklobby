---
phase: 02-dashboard-shell
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/dashboard/app-sidebar.tsx
  - src/app/(dashboard)/layout.tsx

autonomous: true

must_haves:
  truths:
    - "Dashboard has collapsible sidebar navigation"
    - "Sidebar shows Editor, Settings links"
    - "Sidebar state persists across navigation"
  artifacts:
    - path: "src/components/dashboard/app-sidebar.tsx"
      provides: "Sidebar navigation component"
      min_lines: 40
    - path: "src/app/(dashboard)/layout.tsx"
      provides: "Dashboard layout with SidebarProvider"
      contains: "SidebarProvider"
  key_links:
    - from: "src/app/(dashboard)/layout.tsx"
      to: "src/components/dashboard/app-sidebar.tsx"
      via: "AppSidebar component import"
      pattern: "<AppSidebar"
---

<objective>
Create the dashboard sidebar navigation and update the dashboard layout to use SidebarProvider for collapsible navigation.

Purpose: Establish the navigation shell that wraps all dashboard pages.
Output: Working sidebar with Editor and Settings links, collapsible, state persists.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-dashboard-shell/02-RESEARCH.md

@src/app/(dashboard)/layout.tsx
@src/app/(dashboard)/editor/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AppSidebar component</name>
  <files>src/components/dashboard/app-sidebar.tsx</files>
  <action>
Create the sidebar navigation component using shadcn/ui sidebar:

src/components/dashboard/app-sidebar.tsx:
```typescript
"use client"

import Link from "next/link"
import { usePathname } from "next/navigation"
import { LayoutDashboard, Settings, ExternalLink } from "lucide-react"

import {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarHeader,
  SidebarMenu,
  SidebarMenuButton,
  SidebarMenuItem,
} from "@/components/ui/sidebar"

const navItems = [
  {
    title: "Editor",
    href: "/editor",
    icon: LayoutDashboard,
  },
  {
    title: "Settings",
    href: "/settings",
    icon: Settings,
  },
]

interface AppSidebarProps {
  username?: string
}

export function AppSidebar({ username }: AppSidebarProps) {
  const pathname = usePathname()

  return (
    <Sidebar collapsible="icon">
      <SidebarHeader className="border-b border-sidebar-border">
        <div className="flex items-center gap-2 px-2 py-2">
          <div className="flex h-8 w-8 items-center justify-center rounded-lg bg-primary text-primary-foreground font-bold">
            L
          </div>
          <span className="font-semibold group-data-[collapsible=icon]:hidden">
            LinkLobby
          </span>
        </div>
      </SidebarHeader>

      <SidebarContent>
        <SidebarGroup>
          <SidebarGroupLabel>Navigation</SidebarGroupLabel>
          <SidebarGroupContent>
            <SidebarMenu>
              {navItems.map((item) => (
                <SidebarMenuItem key={item.href}>
                  <SidebarMenuButton
                    asChild
                    isActive={pathname === item.href}
                    tooltip={item.title}
                  >
                    <Link href={item.href}>
                      <item.icon className="h-4 w-4" />
                      <span>{item.title}</span>
                    </Link>
                  </SidebarMenuButton>
                </SidebarMenuItem>
              ))}
            </SidebarMenu>
          </SidebarGroupContent>
        </SidebarGroup>
      </SidebarContent>

      <SidebarFooter className="border-t border-sidebar-border">
        {username && (
          <SidebarMenu>
            <SidebarMenuItem>
              <SidebarMenuButton asChild tooltip="View public page">
                <a
                  href={`/${username}`}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="flex items-center gap-2"
                >
                  <ExternalLink className="h-4 w-4" />
                  <span className="group-data-[collapsible=icon]:hidden">
                    linklobby.com/{username}
                  </span>
                </a>
              </SidebarMenuButton>
            </SidebarMenuItem>
          </SidebarMenu>
        )}
      </SidebarFooter>
    </Sidebar>
  )
}
```

Key features:
- collapsible="icon" allows collapse to icons only
- isActive highlights current route
- tooltip shows title when collapsed
- Footer shows public page link with username
- Uses lucide-react icons (already installed)
  </action>
  <verify>
File exists and compiles: `npx tsc --noEmit src/components/dashboard/app-sidebar.tsx`
  </verify>
  <done>AppSidebar component created with navigation items and collapsible support</done>
</task>

<task type="auto">
  <name>Task 2: Update dashboard layout with SidebarProvider</name>
  <files>src/app/(dashboard)/layout.tsx</files>
  <action>
Update the dashboard layout to wrap content with SidebarProvider and include AppSidebar:

src/app/(dashboard)/layout.tsx:
```typescript
import { cookies } from "next/headers"
import { createClient } from "@/lib/supabase/server"
import { SidebarProvider, SidebarInset, SidebarTrigger } from "@/components/ui/sidebar"
import { AppSidebar } from "@/components/dashboard/app-sidebar"
import { Separator } from "@/components/ui/separator"

export default async function DashboardLayout({
  children,
}: {
  children: React.ReactNode
}) {
  // Get sidebar state from cookie for persistence
  const cookieStore = await cookies()
  const defaultOpen = cookieStore.get("sidebar_state")?.value !== "false"

  // Get current user's username for sidebar
  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()

  let username: string | undefined
  if (user) {
    const { data: profile } = await supabase
      .from("profiles")
      .select("username")
      .eq("id", user.id)
      .single()
    username = profile?.username
  }

  return (
    <SidebarProvider defaultOpen={defaultOpen}>
      <AppSidebar username={username} />
      <SidebarInset>
        <header className="flex h-14 items-center gap-2 border-b px-4">
          <SidebarTrigger className="-ml-2" />
          <Separator orientation="vertical" className="h-6" />
          {/* Header content will be added by individual pages or Plan 04 */}
        </header>
        <main className="flex-1 overflow-auto">
          {children}
        </main>
      </SidebarInset>
    </SidebarProvider>
  )
}
```

Key patterns:
- SidebarProvider at layout level for state management
- Cookie-based persistence via sidebar_state cookie (built into shadcn sidebar)
- SidebarInset wraps main content area
- SidebarTrigger in header for collapse/expand
- Separator component needed - add if not present

If Separator not installed, run: `npx shadcn@latest add separator`
  </action>
  <verify>
Run `npm run dev` and visit http://localhost:3000/editor:
1. Sidebar should render on left with "LinkLobby" header
2. Editor and Settings links visible
3. Click SidebarTrigger (hamburger icon) - sidebar collapses to icons
4. Navigate to Settings - active state should highlight Settings
5. Refresh page - sidebar state should persist (collapsed stays collapsed)
  </verify>
  <done>Dashboard layout uses SidebarProvider with collapsible sidebar, state persists via cookie</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. Visit /editor - sidebar visible with Editor highlighted
3. Visit /settings - sidebar visible with Settings highlighted
4. Collapse sidebar - icons only shown
5. Refresh - collapsed state persists
6. Public page link shows username in sidebar footer
</verification>

<success_criteria>
- AppSidebar component renders with Editor and Settings links
- Sidebar collapses to icon-only mode
- Active route highlighted in sidebar
- Sidebar state persists across page refreshes
- Username displayed in sidebar footer with link to public page
</success_criteria>

<output>
After completion, create `.planning/phases/02-dashboard-shell/02-02-SUMMARY.md`
</output>
