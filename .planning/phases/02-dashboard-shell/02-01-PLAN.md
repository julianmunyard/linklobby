---
phase: 02-dashboard-shell
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/app/layout.tsx
  - src/components/theme-provider.tsx
  - src/stores/page-store.ts

autonomous: true

must_haves:
  truths:
    - "Dark mode is default and toggleable"
    - "Page state can be tracked for unsaved changes"
  artifacts:
    - path: "src/components/theme-provider.tsx"
      provides: "Theme context wrapper"
      min_lines: 10
    - path: "src/stores/page-store.ts"
      provides: "Zustand store with hasChanges tracking"
      exports: ["usePageStore"]
  key_links:
    - from: "src/app/layout.tsx"
      to: "src/components/theme-provider.tsx"
      via: "ThemeProvider wrapping children"
      pattern: "ThemeProvider"
---

<objective>
Install Phase 2 dependencies and set up foundational infrastructure: ThemeProvider for dark mode and Zustand store for page state tracking.

Purpose: Establish the state management and theming foundation that all dashboard components will use.
Output: Working ThemeProvider with dark default, Zustand store with hasChanges tracking.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-dashboard-shell/02-RESEARCH.md

@src/app/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and add shadcn components</name>
  <files>package.json</files>
  <action>
Install required dependencies:
```bash
npm install react-resizable-panels zustand
npx shadcn@latest add sidebar tabs alert-dialog dropdown-menu tooltip
```

Note: next-themes is already installed via shadcn init. Verify with `npm ls next-themes`.

Expected additions to package.json:
- react-resizable-panels (latest)
- zustand (latest)
- shadcn components added to src/components/ui/
  </action>
  <verify>
Run `npm ls react-resizable-panels zustand next-themes` - all should show installed versions.
Run `ls src/components/ui/` - should include sidebar.tsx, tabs.tsx, alert-dialog.tsx, dropdown-menu.tsx, tooltip.tsx.
  </verify>
  <done>All dependencies installed, shadcn components available in src/components/ui/</done>
</task>

<task type="auto">
  <name>Task 2: Create ThemeProvider and update root layout</name>
  <files>src/components/theme-provider.tsx, src/app/layout.tsx</files>
  <action>
Create ThemeProvider component following shadcn dark mode pattern:

src/components/theme-provider.tsx:
```typescript
"use client"
import * as React from "react"
import { ThemeProvider as NextThemesProvider } from "next-themes"

export function ThemeProvider({
  children,
  ...props
}: React.ComponentProps<typeof NextThemesProvider>) {
  return <NextThemesProvider {...props}>{children}</NextThemesProvider>
}
```

Update src/app/layout.tsx:
1. Add suppressHydrationWarning to html element (prevents hydration mismatch)
2. Remove hardcoded className="dark" from html
3. Wrap body children with ThemeProvider
4. Set defaultTheme="dark" and attribute="class"

The layout should:
- Import ThemeProvider from @/components/theme-provider
- Keep Inter font and existing metadata
- Use ThemeProvider with defaultTheme="dark", enableSystem, disableTransitionOnChange
  </action>
  <verify>
Run `npm run dev`, open http://localhost:3000.
- Page should render in dark mode by default (dark background)
- No hydration warnings in browser console
- Theme should persist across page refreshes
  </verify>
  <done>Dark mode default via ThemeProvider, no hydration errors</done>
</task>

<task type="auto">
  <name>Task 3: Create Zustand page store with hasChanges tracking</name>
  <files>src/stores/page-store.ts</files>
  <action>
Create Zustand store for page state management:

src/stores/page-store.ts:
```typescript
import { create } from 'zustand'

// Placeholder types - will be refined when cards are implemented
interface Card {
  id: string
  type: string
  position: { x: number; y: number }
  content: Record<string, unknown>
}

interface Theme {
  id: string
  name: string
}

const defaultTheme: Theme = {
  id: 'default',
  name: 'Default'
}

interface PageState {
  // Data
  cards: Card[]
  theme: Theme

  // Tracking
  hasChanges: boolean
  lastSavedAt: number | null

  // Actions
  setCards: (cards: Card[]) => void
  addCard: (card: Card) => void
  updateCard: (id: string, updates: Partial<Card>) => void
  removeCard: (id: string) => void
  setTheme: (theme: Theme) => void
  markSaved: () => void
  discardChanges: () => void

  // For preview sync
  getSnapshot: () => { cards: Card[]; theme: Theme }
}

export const usePageStore = create<PageState>()((set, get) => ({
  cards: [],
  theme: defaultTheme,
  hasChanges: false,
  lastSavedAt: null,

  setCards: (cards) => set({ cards, hasChanges: true }),

  addCard: (card) => set((state) => ({
    cards: [...state.cards, card],
    hasChanges: true
  })),

  updateCard: (id, updates) => set((state) => ({
    cards: state.cards.map((c) =>
      c.id === id ? { ...c, ...updates } : c
    ),
    hasChanges: true,
  })),

  removeCard: (id) => set((state) => ({
    cards: state.cards.filter((c) => c.id !== id),
    hasChanges: true,
  })),

  setTheme: (theme) => set({ theme, hasChanges: true }),

  markSaved: () => set({ hasChanges: false, lastSavedAt: Date.now() }),

  discardChanges: () => {
    // In future: reset to last saved state from DB
    // For now: just clear the flag
    set({ hasChanges: false })
  },

  getSnapshot: () => {
    const { cards, theme } = get()
    return { cards, theme }
  },
}))
```

Key patterns:
- hasChanges set to true on any mutation
- markSaved() called after successful DB save
- discardChanges() resets flag (will load from DB later)
- getSnapshot() for postMessage to preview iframe
  </action>
  <verify>
Create a quick test in browser console or a test file:
```typescript
import { usePageStore } from '@/stores/page-store'
const store = usePageStore.getState()
console.log(store.hasChanges) // false
store.addCard({ id: '1', type: 'test', position: { x: 0, y: 0 }, content: {} })
console.log(store.hasChanges) // true
store.markSaved()
console.log(store.hasChanges) // false
```
Or just verify file compiles: `npx tsc --noEmit src/stores/page-store.ts`
  </verify>
  <done>Zustand store created with Card/Theme types, hasChanges tracking, and all required actions</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. `npm run dev` starts and renders dark mode landing page
3. No TypeScript errors in src/stores/page-store.ts
4. All shadcn components present in src/components/ui/
</verification>

<success_criteria>
- react-resizable-panels and zustand installed
- shadcn sidebar, tabs, alert-dialog, dropdown-menu, tooltip components added
- ThemeProvider wraps app with dark mode default
- Zustand store exports usePageStore with hasChanges tracking
- No build or type errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-dashboard-shell/02-01-SUMMARY.md`
</output>
