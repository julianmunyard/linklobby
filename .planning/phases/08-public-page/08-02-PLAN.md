---
phase: 08-public-page
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/public/static-flow-grid.tsx
  - src/components/public/public-page-renderer.tsx
  - src/components/public/static-profile-header.tsx
autonomous: true

must_haves:
  truths:
    - "Cards render in correct order with proper sizing"
    - "Profile header displays with theme colors"
    - "No client-side interactivity (pure render)"
    - "Hidden cards are filtered out"
  artifacts:
    - path: "src/components/public/static-flow-grid.tsx"
      provides: "Non-interactive card grid"
      exports: ["StaticFlowGrid"]
    - path: "src/components/public/public-page-renderer.tsx"
      provides: "Full page composition"
      exports: ["PublicPageRenderer"]
    - path: "src/components/public/static-profile-header.tsx"
      provides: "Server-rendered profile header"
      exports: ["StaticProfileHeader"]
  key_links:
    - from: "src/components/public/public-page-renderer.tsx"
      to: "src/components/public/static-flow-grid.tsx"
      via: "import and render"
      pattern: "import.*StaticFlowGrid"
    - from: "src/components/public/static-flow-grid.tsx"
      to: "src/components/cards/card-renderer.tsx"
      via: "import CardRenderer"
      pattern: "import.*CardRenderer"
---

<objective>
Create static (non-interactive) components for rendering public pages.

Purpose: Public pages need to render cards and profile without drag-drop, selection, or editing functionality. These components are designed for SSR with zero client-side JavaScript for the core layout.

Output: StaticFlowGrid, PublicPageRenderer, StaticProfileHeader components
</objective>

<execution_context>
@/Users/julianmunyard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/julianmunyard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-public-page/08-CONTEXT.md
@.planning/phases/08-public-page/08-RESEARCH.md
@src/components/canvas/selectable-flow-grid.tsx
@src/components/preview/profile-header.tsx
@src/components/cards/card-renderer.tsx
@src/types/card.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StaticFlowGrid component</name>
  <files>src/components/public/static-flow-grid.tsx</files>
  <action>
Create `src/components/public/static-flow-grid.tsx` - a static version of SelectableFlowGrid without dnd-kit or interactivity:

```typescript
// src/components/public/static-flow-grid.tsx
import { CardRenderer } from '@/components/cards/card-renderer'
import { cn } from '@/lib/utils'
import type { Card } from '@/types/card'

interface StaticFlowGridProps {
  cards: Card[]
}

/**
 * Static flow grid for public pages
 * No drag-drop, no selection, no client-side hooks
 * Pure server-rendered layout
 */
export function StaticFlowGrid({ cards }: StaticFlowGridProps) {
  // Filter out hidden cards and sort by sortKey
  const visibleCards = cards
    .filter((c) => c.is_visible)
    .sort((a, b) => a.sortKey.localeCompare(b.sortKey))

  // Per CONTEXT.md: "Published page with zero cards shows profile header only"
  if (visibleCards.length === 0) {
    return null
  }

  return (
    <div className="flex flex-wrap gap-4">
      {visibleCards.map((card) => (
        <div
          key={card.id}
          className={cn(
            // Size-based width: big = full, small = half
            card.size === 'big' ? 'w-full' : 'w-[calc(50%-0.5rem)]',
            // Gallery cards need overflow-visible for full-bleed circular mode
            card.card_type === 'gallery' && 'overflow-visible'
          )}
        >
          <CardRenderer card={card} isPreview />
        </div>
      ))}
    </div>
  )
}
```

Key differences from SelectableFlowGrid:
- No "use client" directive - can be Server Component
- No dnd-kit, no sensors, no drag handlers
- No multi-select state
- No mounted/hydration guard (not needed without dnd-kit)
- Simpler: just map and render
  </action>
  <verify>
Run `npx tsc --noEmit src/components/public/static-flow-grid.tsx`
Confirm no "use client" at top: `head -1 src/components/public/static-flow-grid.tsx`
  </verify>
  <done>StaticFlowGrid renders cards in flow layout without any client-side interactivity</done>
</task>

<task type="auto">
  <name>Task 2: Create StaticProfileHeader component</name>
  <files>src/components/public/static-profile-header.tsx</files>
  <action>
Create `src/components/public/static-profile-header.tsx` - server-rendered profile header:

```typescript
// src/components/public/static-profile-header.tsx
import Image from 'next/image'
import { cn } from '@/lib/utils'
import type { PublicPageData } from '@/types/page'
import type { SocialIcon } from '@/types/profile'
import { PLATFORM_ICONS } from '@/components/editor/social-icon-picker'

interface StaticProfileHeaderProps {
  profile: PublicPageData['profile']
  iconSize?: number
}

/**
 * Static profile header for public pages
 * Server-rendered, no client state
 */
export function StaticProfileHeader({ profile, iconSize = 24 }: StaticProfileHeaderProps) {
  // Parse social icons from JSON string
  const socialIcons: SocialIcon[] = profile.social_icons
    ? JSON.parse(profile.social_icons)
    : []

  // Sort icons by sortKey
  const sortedIcons = [...socialIcons].sort((a, b) =>
    a.sortKey.localeCompare(b.sortKey)
  )

  const displayName = profile.display_name || profile.username

  // Custom text color or inherit from theme
  const textColorStyle = profile.header_text_color
    ? { color: profile.header_text_color }
    : undefined

  return (
    <div
      className={cn(
        'flex flex-col items-center gap-4 py-6',
        profile.profile_layout === 'hero' && 'py-8'
      )}
      style={textColorStyle}
    >
      {/* Avatar */}
      {profile.show_avatar && profile.avatar_url && (
        <div
          className={cn(
            'relative overflow-hidden rounded-full',
            profile.profile_layout === 'classic' ? 'w-24 h-24' : 'w-32 h-32'
          )}
          style={
            profile.avatar_feather > 0
              ? {
                  maskImage: `radial-gradient(circle, black ${100 - profile.avatar_feather}%, transparent 100%)`,
                  WebkitMaskImage: `radial-gradient(circle, black ${100 - profile.avatar_feather}%, transparent 100%)`,
                }
              : undefined
          }
        >
          <Image
            src={profile.avatar_url}
            alt={displayName}
            fill
            className="object-cover"
            priority
          />
        </div>
      )}

      {/* Logo */}
      {profile.show_logo && profile.logo_url && (
        <img
          src={profile.logo_url}
          alt={`${displayName} logo`}
          style={{
            maxHeight: `${(profile.logo_scale / 100) * 80}px`,
            width: 'auto',
          }}
        />
      )}

      {/* Title */}
      {profile.show_title && (
        <h1
          className={cn(
            'font-bold text-center',
            profile.title_size === 'large' ? 'text-3xl' : 'text-xl'
          )}
          style={{ fontFamily: 'var(--theme-heading-font)' }}
        >
          {displayName}
        </h1>
      )}

      {/* Bio */}
      {profile.bio && (
        <p
          className="text-center max-w-md text-sm opacity-80"
          style={{ fontFamily: 'var(--theme-body-font)' }}
        >
          {profile.bio}
        </p>
      )}

      {/* Social Icons */}
      {profile.show_social_icons && sortedIcons.length > 0 && (
        <div className="flex gap-3 mt-2">
          {sortedIcons.map((icon) => {
            const IconComponent = PLATFORM_ICONS[icon.platform]
            if (!IconComponent) return null

            return (
              <a
                key={icon.id}
                href={icon.url}
                target="_blank"
                rel="noopener noreferrer"
                className="transition-opacity hover:opacity-70"
                aria-label={icon.platform}
              >
                <div style={{ width: iconSize, height: iconSize }}>
                  <IconComponent className="w-full h-full" />
                </div>
              </a>
            )
          })}
        </div>
      )}
    </div>
  )
}
```

Key differences from editor ProfileHeader:
- No "use client" - server-rendered
- Receives profile data as prop (not from store)
- Parses social_icons JSON string
- No edit interactions
- Uses Next/Image with priority for LCP
  </action>
  <verify>
Run `npx tsc --noEmit src/components/public/static-profile-header.tsx`
  </verify>
  <done>StaticProfileHeader renders profile with avatar, title, bio, and social icons from props</done>
</task>

<task type="auto">
  <name>Task 3: Create PublicPageRenderer component</name>
  <files>src/components/public/public-page-renderer.tsx</files>
  <action>
Create `src/components/public/public-page-renderer.tsx` - composes the full public page:

```typescript
// src/components/public/public-page-renderer.tsx
import { StaticFlowGrid } from './static-flow-grid'
import { StaticProfileHeader } from './static-profile-header'
import type { PublicPageData } from '@/types/page'

interface PublicPageRendererProps {
  data: PublicPageData
  socialIconSize?: number
}

/**
 * Renders a complete public profile page
 * Composes profile header + card grid
 * Server-rendered for instant SSR
 */
export function PublicPageRenderer({ data, socialIconSize = 24 }: PublicPageRendererProps) {
  const { profile, cards } = data

  return (
    <main className="min-h-screen">
      {/* Page content container - max width and centered */}
      <div className="mx-auto max-w-2xl px-4 pb-12">
        {/* Profile header */}
        <StaticProfileHeader profile={profile} iconSize={socialIconSize} />

        {/* Cards */}
        <div className="mt-6">
          <StaticFlowGrid cards={cards} />
        </div>
      </div>
    </main>
  )
}
```

The component:
- Composes header + grid
- Uses max-w-2xl container (same as editor preview width)
- Has padding and spacing
- No "use client" - fully server-rendered
  </action>
  <verify>
Run `npx tsc --noEmit src/components/public/public-page-renderer.tsx`
Confirm exports: `grep "export function PublicPageRenderer" src/components/public/public-page-renderer.tsx`
  </verify>
  <done>PublicPageRenderer composes StaticProfileHeader and StaticFlowGrid into complete page</done>
</task>

</tasks>

<verification>
1. All files created: `ls src/components/public/`
2. Types compile: `npx tsc --noEmit`
3. No "use client" in files (server components): `grep -l "use client" src/components/public/*.tsx || echo "No client directives - good"`
4. All exports present: `grep -h "export function" src/components/public/*.tsx`
</verification>

<success_criteria>
- StaticFlowGrid renders cards without dnd-kit or interactivity
- StaticProfileHeader displays profile data from props
- PublicPageRenderer composes complete page structure
- All components are Server Components (no "use client")
- Hidden cards are filtered out
- Cards sorted by sortKey
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/08-public-page/08-02-SUMMARY.md`
</output>
