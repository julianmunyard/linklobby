---
phase: 07-theme-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/theme.ts
  - src/stores/theme-store.ts
  - src/lib/themes/index.ts
  - src/lib/themes/mac-os.ts
  - src/lib/themes/sleek-modern.ts
  - src/lib/themes/instagram-reels.ts
  - src/components/theme-applicator.tsx
autonomous: true

must_haves:
  truths:
    - "Theme store persists selected theme across page refreshes"
    - "ThemeApplicator sets data-theme attribute on document root"
    - "All three theme configurations have default colors, fonts, and styles"
  artifacts:
    - path: "src/types/theme.ts"
      provides: "Theme type definitions"
      exports: ["ThemeId", "ThemeConfig", "ColorPalette", "FontConfig", "StyleConfig"]
    - path: "src/stores/theme-store.ts"
      provides: "Zustand theme store with persist"
      exports: ["useThemeStore"]
    - path: "src/lib/themes/index.ts"
      provides: "Theme registry and utilities"
      exports: ["THEMES", "getTheme", "getThemeDefaults"]
    - path: "src/components/theme-applicator.tsx"
      provides: "Component that applies theme to DOM"
      exports: ["ThemeApplicator"]
  key_links:
    - from: "src/stores/theme-store.ts"
      to: "src/lib/themes/index.ts"
      via: "getThemeDefaults call in setTheme"
      pattern: "getThemeDefaults"
    - from: "src/components/theme-applicator.tsx"
      to: "src/stores/theme-store.ts"
      via: "useThemeStore subscription"
      pattern: "useThemeStore"
---

<objective>
Create the theme system infrastructure: types, store, theme configurations, and DOM applicator.

Purpose: Establishes the foundation for the entire theme system - all subsequent plans depend on these types and store.
Output: Theme types, Zustand store with persistence, three theme configurations with defaults, and ThemeApplicator component.
</objective>

<execution_context>
@/Users/julianmunyard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/julianmunyard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-theme-system/07-CONTEXT.md
@.planning/phases/07-theme-system/07-RESEARCH.md

# Existing patterns to follow
@src/stores/page-store.ts
@src/stores/profile-store.ts
@src/types/card.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create theme types and configurations</name>
  <files>
    src/types/theme.ts
    src/lib/themes/index.ts
    src/lib/themes/mac-os.ts
    src/lib/themes/sleek-modern.ts
    src/lib/themes/instagram-reels.ts
  </files>
  <action>
Create comprehensive theme type definitions in src/types/theme.ts:

```typescript
export type ThemeId = 'mac-os' | 'sleek-modern' | 'instagram-reels'

export interface ColorPalette {
  background: string      // Page background
  cardBg: string          // Card background
  text: string            // Primary text
  accent: string          // Accent/highlight color
  border: string          // Border color
  link: string            // Link color
}

export interface FontConfig {
  heading: string         // CSS variable name (e.g., '--font-inter')
  body: string            // CSS variable name
  headingSize: number     // rem multiplier (1 = base, 1.25 = 25% larger)
  bodySize: number        // rem multiplier
  headingWeight: 'normal' | 'bold'
}

export interface StyleConfig {
  borderRadius: number    // px value
  shadowEnabled: boolean
  blurIntensity: number   // 0-32 px
}

export interface BackgroundConfig {
  type: 'solid' | 'image' | 'video'
  value: string           // color hex, image URL, or video URL
}

export interface ThemeConfig {
  id: ThemeId
  name: string
  description: string
  defaultColors: ColorPalette
  defaultFonts: FontConfig
  defaultStyle: StyleConfig
  palettes: Array<{ id: string; name: string; colors: ColorPalette }>
  // Theme-specific features
  hasTrafficLights?: boolean   // Mac OS only
  hasGlassEffect?: boolean     // Sleek Modern only
  hasSpreadText?: boolean      // Instagram Reels only
}

export interface ThemeState {
  themeId: ThemeId
  paletteId: string | null
  colors: ColorPalette
  fonts: FontConfig
  style: StyleConfig
  background: BackgroundConfig
}
```

Create theme configuration files following these specifications from CONTEXT.md:

**Mac OS theme (src/lib/themes/mac-os.ts):**
- Shadows, traffic light icons, window-like depth
- Darker card backgrounds with subtle borders
- 10px border radius (rounded but not pill-shaped)
- Strong drop shadows enabled by default
- 2-3 preset palettes: "Monterey Dark", "Sonoma Light", "Space Gray"

**Sleek Modern theme (src/lib/themes/sleek-modern.ts):**
- Transparent, glass texture, flat aesthetic
- Card background with alpha transparency
- 16px border radius (more rounded)
- No shadows, glass blur enabled
- 2-3 preset palettes: "Frosted Glass", "Neon Night", "Minimal White"

**Instagram Reels theme (src/lib/themes/instagram-reels.ts):**
- Bold, high contrast, spread text styling
- Strong accent colors
- 8px border radius (subtle rounding)
- Minimal shadows
- 2-3 preset palettes: "IG Dark", "Creator Gradient", "Vibrant"

Create src/lib/themes/index.ts with theme registry:
- Export THEMES array with all three configs
- Export getTheme(id: ThemeId) helper
- Export getThemeDefaults(id: ThemeId) returning default colors/fonts/style
- Export THEME_IDS array for iteration

Use OKLCH color format for all colors (consistent with existing globals.css).
  </action>
  <verify>
Run `npx tsc --noEmit` to verify types compile without errors. Grep for exports: `grep -E "export (type|interface|const|function)" src/types/theme.ts src/lib/themes/*.ts`
  </verify>
  <done>
Theme types exported from src/types/theme.ts. Three theme configs in src/lib/themes/. Registry in index.ts exports THEMES, getTheme, getThemeDefaults.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create theme store with persistence</name>
  <files>
    src/stores/theme-store.ts
  </files>
  <action>
Create Zustand theme store with persist middleware following the pattern in profile-store.ts:

```typescript
import { create } from 'zustand'
import { persist, createJSONStorage } from 'zustand/middleware'
import type { ThemeId, ColorPalette, FontConfig, StyleConfig, BackgroundConfig, ThemeState } from '@/types/theme'
import { getThemeDefaults } from '@/lib/themes'

interface ThemeStore extends ThemeState {
  // Actions
  setTheme: (themeId: ThemeId) => void
  setPalette: (paletteId: string) => void
  setColor: (key: keyof ColorPalette, value: string) => void
  setFont: (key: keyof FontConfig, value: string | number) => void
  setStyle: (key: keyof StyleConfig, value: number | boolean) => void
  setBackground: (background: BackgroundConfig) => void
  resetToThemeDefaults: () => void
}
```

Key implementation details:
1. Default to 'sleek-modern' theme (per research recommendation)
2. Use `createJSONStorage(() => localStorage)` for persistence
3. Persist all theme state fields (themeId, paletteId, colors, fonts, style, background)
4. `setTheme` should load defaults from getThemeDefaults and merge with persisted customizations
5. `setPalette` should load colors from the palette and set paletteId
6. `setColor` should set paletteId to null (indicates custom)
7. `resetToThemeDefaults` should reload defaults from current theme config
8. Storage key: 'linklobby-theme'

Initial state should default to sleek-modern theme with dark background per CONTEXT.md ("dark background by default - artist/DJ preference").
  </action>
  <verify>
Run `npx tsc --noEmit`. Import test: add `import { useThemeStore } from '@/stores/theme-store'` to a test file and verify no import errors.
  </verify>
  <done>
Theme store created with all actions. Persists to localStorage under 'linklobby-theme'. Default theme is sleek-modern with dark colors.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create ThemeApplicator component</name>
  <files>
    src/components/theme-applicator.tsx
  </files>
  <action>
Create a client component that applies theme state to the DOM:

```typescript
'use client'

import { useEffect } from 'react'
import { useThemeStore } from '@/stores/theme-store'

export function ThemeApplicator({ children }: { children: React.ReactNode }) {
  const { themeId, colors, fonts, style, background } = useThemeStore()

  useEffect(() => {
    const root = document.documentElement

    // Set theme attribute for CSS theme variants
    root.setAttribute('data-theme', themeId)

    // Apply color overrides as CSS variables
    root.style.setProperty('--theme-background', colors.background)
    root.style.setProperty('--theme-card-bg', colors.cardBg)
    root.style.setProperty('--theme-text', colors.text)
    root.style.setProperty('--theme-accent', colors.accent)
    root.style.setProperty('--theme-border', colors.border)
    root.style.setProperty('--theme-link', colors.link)

    // Apply font overrides
    root.style.setProperty('--theme-font-heading', fonts.heading)
    root.style.setProperty('--theme-font-body', fonts.body)
    root.style.setProperty('--theme-heading-size', `${fonts.headingSize}rem`)
    root.style.setProperty('--theme-body-size', `${fonts.bodySize}rem`)
    root.style.setProperty('--theme-heading-weight', fonts.headingWeight === 'bold' ? '700' : '400')

    // Apply style overrides
    root.style.setProperty('--theme-border-radius', `${style.borderRadius}px`)
    root.style.setProperty('--theme-shadow-enabled', style.shadowEnabled ? '1' : '0')
    root.style.setProperty('--theme-blur-intensity', `${style.blurIntensity}px`)

    // Apply background
    root.style.setProperty('--theme-bg-type', background.type)
    if (background.type === 'solid') {
      root.style.setProperty('--theme-bg-value', background.value)
    }
  }, [themeId, colors, fonts, style, background])

  return <>{children}</>
}
```

This component:
1. Subscribes to theme store
2. Sets `data-theme` attribute on documentElement for CSS variant selection
3. Injects all CSS variables as inline styles on :root
4. Re-runs effect when any theme value changes
5. Does NOT handle hydration issues yet (that's addressed in CSS plan)

Note: Image and video backgrounds will be handled separately in a later task (they need different DOM structure).
  </action>
  <verify>
Run `npx tsc --noEmit`. The component should compile. Check that it exports ThemeApplicator: `grep "export function ThemeApplicator" src/components/theme-applicator.tsx`
  </verify>
  <done>
ThemeApplicator component created. Sets data-theme attribute and injects CSS variables from theme store.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. Theme types can be imported: `import type { ThemeId, ThemeConfig } from '@/types/theme'`
3. Theme store can be imported: `import { useThemeStore } from '@/stores/theme-store'`
4. All three themes have configurations in src/lib/themes/
5. ThemeApplicator can be imported: `import { ThemeApplicator } from '@/components/theme-applicator'`
</verification>

<success_criteria>
- Theme type definitions complete with ThemeId, ThemeConfig, ColorPalette, FontConfig, StyleConfig
- Three theme configs defined with distinct aesthetics and 2-3 palettes each
- Zustand store with persist middleware stores/restores theme state
- ThemeApplicator component applies theme to DOM via data attribute and CSS variables
- All code compiles without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-theme-system/07-01-SUMMARY.md`
</output>
