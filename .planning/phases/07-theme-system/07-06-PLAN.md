---
phase: 07-theme-system
plan: 06
type: execute
wave: 4
depends_on: ["07-05"]
files_modified:
  - src/components/preview/themed-card-wrapper.tsx
  - src/components/preview/mac-os-card.tsx
  - src/components/preview/glass-card.tsx
  - src/components/preview/card-renderer.tsx
  - src/components/preview/profile-header.tsx
  - src/app/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Cards use theme CSS variables for colors, fonts, borders"
    - "Mac OS theme shows traffic light buttons on cards"
    - "Sleek Modern theme shows glass blur effect on cards"
    - "Profile header follows same theme styling as cards"
    - "Circular gallery and game cards remain visually unchanged"
  artifacts:
    - path: "src/components/preview/themed-card-wrapper.tsx"
      provides: "Theme-aware card wrapper selecting appropriate style"
      exports: ["ThemedCardWrapper"]
    - path: "src/components/preview/mac-os-card.tsx"
      provides: "Mac OS styled card with traffic lights"
      exports: ["MacOSCard", "MacOSTrafficLights"]
    - path: "src/components/preview/glass-card.tsx"
      provides: "Glassmorphism card for Sleek Modern"
      exports: ["GlassCard"]
  key_links:
    - from: "src/components/preview/card-renderer.tsx"
      to: "src/components/preview/themed-card-wrapper.tsx"
      via: "ThemedCardWrapper wrapping card content"
      pattern: "ThemedCardWrapper"
    - from: "src/app/layout.tsx"
      to: "src/components/theme-applicator.tsx"
      via: "ThemeApplicator wrapper"
      pattern: "ThemeApplicator"
---

<objective>
Update card components to use theme CSS variables and create theme-specific wrappers (Mac OS, Glass).

Purpose: Theme changes need to visually affect all cards. This connects the theme system to the actual card rendering.
Output: Themed card wrappers, card renderer updates, profile header theming, ThemeApplicator integration.
</objective>

<execution_context>
@/Users/julianmunyard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/julianmunyard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/07-theme-system/07-CONTEXT.md
@.planning/phases/07-theme-system/07-RESEARCH.md

# Prior plan references
@src/stores/theme-store.ts
@src/components/theme-applicator.tsx
@src/app/globals.css

# Existing card components
@src/components/preview/card-renderer.tsx
@src/components/preview/profile-header.tsx
@src/types/card.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Mac OS and Glass card wrappers</name>
  <files>
    src/components/preview/mac-os-card.tsx
    src/components/preview/glass-card.tsx
    src/components/preview/themed-card-wrapper.tsx
  </files>
  <action>
Create theme-specific card wrapper components.

**Mac OS Card (src/components/preview/mac-os-card.tsx):**

```typescript
'use client'

import { cn } from '@/lib/utils'

export function MacOSTrafficLights({ className }: { className?: string }) {
  return (
    <div className={cn("flex items-center gap-2", className)}>
      <div className="w-3 h-3 rounded-full bg-[#ff5f57] border border-[#e14942]" />
      <div className="w-3 h-3 rounded-full bg-[#febc2e] border border-[#dea123]" />
      <div className="w-3 h-3 rounded-full bg-[#28c840] border border-[#1dad2b]" />
    </div>
  )
}

interface MacOSCardProps {
  children: React.ReactNode
  className?: string
}

export function MacOSCard({ children, className }: MacOSCardProps) {
  return (
    <div
      className={cn(
        "overflow-hidden",
        "bg-theme-card-bg border border-theme-border",
        "shadow-theme-card",
        className
      )}
      style={{ borderRadius: 'var(--theme-border-radius)' }}
    >
      {/* Title bar with traffic lights */}
      <div className="flex items-center gap-2 px-3 py-2 bg-gradient-to-b from-white/5 to-transparent border-b border-white/10">
        <MacOSTrafficLights />
      </div>
      {/* Content */}
      <div>
        {children}
      </div>
    </div>
  )
}
```

**Glass Card (src/components/preview/glass-card.tsx):**

```typescript
'use client'

import { cn } from '@/lib/utils'
import { useThemeStore } from '@/stores/theme-store'

interface GlassCardProps {
  children: React.ReactNode
  className?: string
}

export function GlassCard({ children, className }: GlassCardProps) {
  const { style } = useThemeStore()

  return (
    <div
      className={cn(
        "overflow-hidden glass-card",
        "bg-theme-card-bg border border-theme-border",
        className
      )}
      style={{
        borderRadius: 'var(--theme-border-radius)',
        backdropFilter: `blur(${style.blurIntensity}px)`,
        WebkitBackdropFilter: `blur(${style.blurIntensity}px)`,
      }}
    >
      {children}
    </div>
  )
}
```

**Themed Card Wrapper (src/components/preview/themed-card-wrapper.tsx):**

```typescript
'use client'

import { useThemeStore } from '@/stores/theme-store'
import { MacOSCard } from './mac-os-card'
import { GlassCard } from './glass-card'
import { cn } from '@/lib/utils'
import type { CardType } from '@/types/card'

interface ThemedCardWrapperProps {
  children: React.ReactNode
  cardType: CardType
  className?: string
}

// Card types exempt from theming (per CONTEXT.md)
const EXEMPT_CARD_TYPES: CardType[] = ['game', 'gallery']

export function ThemedCardWrapper({ children, cardType, className }: ThemedCardWrapperProps) {
  const { themeId, style } = useThemeStore()

  // Exempt cards get standard wrapper
  if (EXEMPT_CARD_TYPES.includes(cardType)) {
    return (
      <div className={cn("overflow-hidden", className)}>
        {children}
      </div>
    )
  }

  // Theme-specific wrappers
  switch (themeId) {
    case 'mac-os':
      return (
        <MacOSCard className={className}>
          {children}
        </MacOSCard>
      )

    case 'sleek-modern':
      return (
        <GlassCard className={className}>
          {children}
        </GlassCard>
      )

    case 'instagram-reels':
    default:
      // Standard themed card
      return (
        <div
          className={cn(
            "overflow-hidden",
            "bg-theme-card-bg border border-theme-border",
            style.shadowEnabled && "shadow-theme-card",
            className
          )}
          style={{ borderRadius: 'var(--theme-border-radius)' }}
        >
          {children}
        </div>
      )
  }
}
```

Key features:
- Mac OS has traffic lights in title bar
- Glass card has backdrop blur
- Instagram Reels uses standard themed styling
- Game and gallery cards are exempt from theming
- All use CSS variables for colors
  </action>
  <verify>
Run `npx tsc --noEmit`. Check exports: `grep -E "export function" src/components/preview/mac-os-card.tsx src/components/preview/glass-card.tsx src/components/preview/themed-card-wrapper.tsx`
  </verify>
  <done>
Mac OS card with traffic lights, Glass card with blur, and ThemedCardWrapper selecting appropriate style based on theme.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update CardRenderer to use themed wrapper</name>
  <files>
    src/components/preview/card-renderer.tsx
  </files>
  <action>
Update CardRenderer to wrap card content with ThemedCardWrapper.

This requires modifying the existing card-renderer.tsx to:

1. Import ThemedCardWrapper
2. Wrap the card output with ThemedCardWrapper, passing cardType
3. Update text elements to use theme font CSS variables
4. Update link colors to use theme-link

Example pattern:

```typescript
import { ThemedCardWrapper } from './themed-card-wrapper'

// In the render:
return (
  <ThemedCardWrapper cardType={card.card_type} className="...">
    {/* Existing card content */}
    <div style={{ fontFamily: 'var(--font-theme-heading)', color: 'var(--color-theme-text)' }}>
      {card.title}
    </div>
    <div style={{ fontFamily: 'var(--font-theme-body)', color: 'var(--color-theme-text)' }}>
      {card.description}
    </div>
  </ThemedCardWrapper>
)
```

Update each card type rendering to use:
- `text-theme-text` or `color: var(--color-theme-text)` for text
- `font-theme-heading` / `font-theme-body` for fonts
- `text-theme-link` for link colors
- `bg-theme-accent` for accent backgrounds

Do NOT change the structure of card-specific components (HeroCard, HorizontalLinkCard, etc.) yet - just wrap them and apply theme classes where appropriate.

For game and gallery cards, ThemedCardWrapper will pass through without modification (they're exempt).
  </action>
  <verify>
Run `npm run dev`. View preview with different card types. Switch themes in editor. Cards should visually update with theme colors and fonts.
  </verify>
  <done>
CardRenderer wraps all cards with ThemedCardWrapper. Cards use theme CSS variables for colors and fonts.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update profile header and integrate ThemeApplicator</name>
  <files>
    src/components/preview/profile-header.tsx
    src/app/layout.tsx
  </files>
  <action>
**Update profile-header.tsx:**

Per CONTEXT.md: "Profile header follows theme - same styling as cards"

Apply theme CSS variables to profile header:
- Background uses theme-background or theme-card-bg
- Text uses theme-text
- Name uses theme-heading font
- Bio uses theme-body font
- Social icons use theme-link color on hover

```typescript
// Example updates in profile-header.tsx:
<div className="text-theme-text" style={{ fontFamily: 'var(--font-theme-heading)' }}>
  {profile.displayName}
</div>
<p className="text-theme-text/70" style={{ fontFamily: 'var(--font-theme-body)' }}>
  {profile.bio}
</p>
```

**Integrate ThemeApplicator in layout.tsx:**

Wrap the app with ThemeApplicator so theme CSS variables are applied to the document:

```typescript
import { ThemeApplicator } from '@/components/theme-applicator'

// In the body:
<body className={`${geistSans.variable} ${geistMono.variable} ${fontVariables} antialiased`}>
  <ThemeApplicator>
    {children}
  </ThemeApplicator>
</body>
```

This ensures:
1. data-theme attribute is set on documentElement
2. CSS variables are injected when theme changes
3. All components receive theme styles
  </action>
  <verify>
Run `npm run dev`. Navigate to editor. Change theme. Verify:
- Profile header text updates with theme font
- Profile header colors match theme
- Cards update with theme styling
- Theme persists on page refresh
  </verify>
  <done>
Profile header uses theme fonts and colors. ThemeApplicator integrated into root layout. Theme system fully connected to UI.
  </done>
</task>

</tasks>

<verification>
1. `npm run dev` runs without errors
2. Switch to Mac OS theme - cards show traffic light buttons
3. Switch to Sleek Modern theme - cards have glass blur effect
4. Switch to Instagram Reels theme - cards have standard themed style
5. Game cards remain unchanged regardless of theme
6. Gallery cards remain unchanged regardless of theme
7. Profile header updates with theme fonts and colors
8. Theme persists across page refresh
9. Preview updates instantly when theme is changed
</verification>

<success_criteria>
- Mac OS theme displays traffic lights on cards
- Sleek Modern theme displays glass blur effect
- All themes apply colors via CSS variables
- Profile header follows theme styling
- Game and gallery cards are exempt from theming
- ThemeApplicator integrated into root layout
- Theme changes instantly reflected in preview
</success_criteria>

<output>
After completion, create `.planning/phases/07-theme-system/07-06-SUMMARY.md`
</output>
