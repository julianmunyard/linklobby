---
phase: 07-theme-system
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/globals.css
  - src/app/fonts.ts
  - src/app/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Theme CSS variables are available as Tailwind utilities (bg-theme-background, text-theme-text, etc.)"
    - "Data attribute variants work ([data-theme='mac-os'] selectors apply)"
    - "Curated fonts load without FOUT/FOIT (flash of unstyled text)"
  artifacts:
    - path: "src/app/globals.css"
      provides: "Theme CSS variable bridge and theme variants"
      contains: "@theme inline"
    - path: "src/app/fonts.ts"
      provides: "Curated font exports with CSS variables"
      exports: ["fontVariables", "CURATED_FONTS"]
    - path: "src/app/layout.tsx"
      provides: "Root layout with font classes applied"
      contains: "fontVariables"
  key_links:
    - from: "src/app/layout.tsx"
      to: "src/app/fonts.ts"
      via: "fontVariables import"
      pattern: "fontVariables"
    - from: "src/app/globals.css"
      to: "Tailwind utilities"
      via: "@theme inline directive"
      pattern: "--color-theme-"
---

<objective>
Set up theme CSS variables in Tailwind and load curated fonts via next/font/google.

Purpose: CSS infrastructure that connects theme store values to actual styling. Without this, theme changes have no visual effect.
Output: Extended globals.css with theme tokens, font loading setup, layout integration.
</objective>

<execution_context>
@/Users/julianmunyard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/julianmunyard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/07-theme-system/07-CONTEXT.md
@.planning/phases/07-theme-system/07-RESEARCH.md

# Existing CSS to extend
@src/app/globals.css
@src/app/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend globals.css with theme CSS variables</name>
  <files>
    src/app/globals.css
  </files>
  <action>
Extend the existing globals.css (DO NOT replace, ADD to existing content).

Add theme token bridge INSIDE the existing @theme inline block:

```css
@theme inline {
  /* ... existing shadcn variables ... */

  /* Theme token bridge - makes theme variables available as Tailwind utilities */
  --color-theme-background: var(--theme-background);
  --color-theme-card-bg: var(--theme-card-bg);
  --color-theme-text: var(--theme-text);
  --color-theme-accent: var(--theme-accent);
  --color-theme-border: var(--theme-border);
  --color-theme-link: var(--theme-link);

  /* Font tokens */
  --font-theme-heading: var(--theme-font-heading, var(--font-geist-sans));
  --font-theme-body: var(--theme-font-body, var(--font-geist-sans));

  /* Style tokens */
  --radius-theme-card: var(--theme-border-radius, 0.75rem);
  --shadow-theme-card: var(--theme-shadow);
}
```

Add default theme variable values in :root (AFTER existing :root block or merged into it):

```css
:root {
  /* ... existing values ... */

  /* Theme defaults (dark by default per CONTEXT.md) */
  --theme-background: oklch(0.145 0 0);
  --theme-card-bg: oklch(0.205 0 0);
  --theme-text: oklch(0.985 0 0);
  --theme-accent: oklch(0.7 0.15 250);
  --theme-border: oklch(1 0 0 / 10%);
  --theme-link: oklch(0.7 0.2 250);
  --theme-font-heading: var(--font-geist-sans);
  --theme-font-body: var(--font-geist-sans);
  --theme-border-radius: 12px;
  --theme-blur-intensity: 16px;
  --theme-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
  --theme-shadow-enabled: 1;
}
```

Add theme variant selectors AFTER @layer base:

```css
/* Mac OS Theme Variants */
[data-theme="mac-os"] {
  --theme-shadow: 0 10px 25px -5px rgb(0 0 0 / 0.3), 0 4px 6px -2px rgb(0 0 0 / 0.2);
}

/* Sleek Modern Theme Variants */
[data-theme="sleek-modern"] {
  --theme-shadow: none;
}

/* Instagram Reels Theme Variants */
[data-theme="instagram-reels"] {
  --theme-shadow: 0 2px 4px rgb(0 0 0 / 0.1);
}

/* Shadow utility that respects theme */
.shadow-theme-card {
  box-shadow: var(--theme-shadow);
}

/* Glassmorphism support for Sleek Modern */
[data-theme="sleek-modern"] .glass-card {
  backdrop-filter: blur(var(--theme-blur-intensity));
  -webkit-backdrop-filter: blur(var(--theme-blur-intensity));
}

@supports not (backdrop-filter: blur(1px)) {
  [data-theme="sleek-modern"] .glass-card {
    background: oklch(0.15 0 0 / 90%);
  }
}
```

Important: Preserve ALL existing CSS. Add new code, don't replace.
  </action>
  <verify>
Run `npm run dev` and check that the page loads without CSS errors. Inspect :root in DevTools and verify --theme-* variables exist. Test: `grep -c "theme-background" src/app/globals.css` should return at least 2.
  </verify>
  <done>
globals.css extended with theme tokens in @theme inline, default values in :root, and theme variant selectors for all three themes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Set up curated font loading</name>
  <files>
    src/app/fonts.ts
  </files>
  <action>
Create src/app/fonts.ts with curated Google Fonts using next/font/google.

Per CONTEXT.md: "Curated font list (15-20) - Hand-picked fonts that work for artists"

Select fonts covering these categories:
- Clean sans-serif (Inter, DM Sans, Plus Jakarta Sans)
- Modern geometric (Poppins, Outfit, Space Grotesk)
- Display/bold (Bebas Neue, Oswald, Archivo Black)
- Elegant serif (Playfair Display)
- Versatile (Montserrat, Roboto, Open Sans)
- Trendy (Sora, Urbanist)

```typescript
import {
  Inter,
  Poppins,
  Playfair_Display,
  Montserrat,
  Roboto,
  Open_Sans,
  Bebas_Neue,
  Oswald,
  Archivo_Black,
  Space_Grotesk,
  DM_Sans,
  Outfit,
  Plus_Jakarta_Sans,
  Sora,
  Urbanist,
} from 'next/font/google'

// Variable fonts (single file, all weights)
export const inter = Inter({
  subsets: ['latin'],
  variable: '--font-inter',
  display: 'swap',
})

export const poppins = Poppins({
  subsets: ['latin'],
  weight: ['400', '500', '600', '700'],
  variable: '--font-poppins',
  display: 'swap',
})

// ... define all fonts similarly

// Combine all font variables for layout className
export const fontVariables = [
  inter.variable,
  poppins.variable,
  playfairDisplay.variable,
  montserrat.variable,
  roboto.variable,
  openSans.variable,
  bebasNeue.variable,
  oswald.variable,
  archivoBlack.variable,
  spaceGrotesk.variable,
  dmSans.variable,
  outfit.variable,
  plusJakartaSans.variable,
  sora.variable,
  urbanist.variable,
].join(' ')

// Font registry for UI font picker
export const CURATED_FONTS = [
  { id: 'inter', name: 'Inter', variable: 'var(--font-inter)', category: 'sans' as const },
  { id: 'poppins', name: 'Poppins', variable: 'var(--font-poppins)', category: 'sans' as const },
  { id: 'playfair', name: 'Playfair Display', variable: 'var(--font-playfair)', category: 'serif' as const },
  { id: 'montserrat', name: 'Montserrat', variable: 'var(--font-montserrat)', category: 'sans' as const },
  { id: 'roboto', name: 'Roboto', variable: 'var(--font-roboto)', category: 'sans' as const },
  { id: 'open-sans', name: 'Open Sans', variable: 'var(--font-open-sans)', category: 'sans' as const },
  { id: 'bebas-neue', name: 'Bebas Neue', variable: 'var(--font-bebas-neue)', category: 'display' as const },
  { id: 'oswald', name: 'Oswald', variable: 'var(--font-oswald)', category: 'display' as const },
  { id: 'archivo-black', name: 'Archivo Black', variable: 'var(--font-archivo-black)', category: 'display' as const },
  { id: 'space-grotesk', name: 'Space Grotesk', variable: 'var(--font-space-grotesk)', category: 'sans' as const },
  { id: 'dm-sans', name: 'DM Sans', variable: 'var(--font-dm-sans)', category: 'sans' as const },
  { id: 'outfit', name: 'Outfit', variable: 'var(--font-outfit)', category: 'sans' as const },
  { id: 'jakarta', name: 'Plus Jakarta Sans', variable: 'var(--font-jakarta)', category: 'sans' as const },
  { id: 'sora', name: 'Sora', variable: 'var(--font-sora)', category: 'sans' as const },
  { id: 'urbanist', name: 'Urbanist', variable: 'var(--font-urbanist)', category: 'sans' as const },
] as const

export type FontId = typeof CURATED_FONTS[number]['id']
export type FontCategory = 'sans' | 'serif' | 'display'
```

Use `display: 'swap'` for all fonts to prevent blocking render.
Use subsets: ['latin'] to reduce bundle size.
For non-variable fonts, include weights ['400', '500', '600', '700'].

**Performance note:** next/font only downloads fonts that are actually used in the rendered page. The 15 fonts are registered but not all loaded upfront - fonts are loaded on-demand when CSS variables referencing them are applied. This means no 15-font bundle penalty; only the fonts actually visible get network requests.
  </action>
  <verify>
Run `npx tsc --noEmit`. Check exports: `grep -E "export (const|type)" src/app/fonts.ts`. Verify all fonts have variables defined.
  </verify>
  <done>
15 curated fonts loaded via next/font/google. fontVariables string ready for layout. CURATED_FONTS array ready for font picker UI.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate fonts into root layout</name>
  <files>
    src/app/layout.tsx
  </files>
  <action>
Update src/app/layout.tsx to include font variables.

1. Import fontVariables from './fonts'
2. Add fontVariables to the body or html className

Look at existing layout structure and add fonts appropriately. The layout likely already has Geist Sans/Mono via localFont - keep those and ADD the new fonts.

Example integration:

```typescript
import { fontVariables } from './fonts'

// In the html or body element:
<body className={`${geistSans.variable} ${geistMono.variable} ${fontVariables} antialiased`}>
```

This makes all font CSS variables available throughout the app.

Note: Do NOT add ThemeApplicator here yet - that will be integrated in a later plan once we verify the preview sync pattern.
  </action>
  <verify>
Run `npm run dev` and verify page loads. Open DevTools, check that font variables (--font-inter, --font-poppins, etc.) are available on html/body element.
  </verify>
  <done>
Font variables added to root layout. All 15 fonts available as CSS variables site-wide.
  </done>
</task>

</tasks>

<verification>
1. `npm run dev` starts without errors
2. DevTools shows --theme-* variables on :root
3. DevTools shows --font-* variables (inter, poppins, etc.) on body/html
4. Tailwind utilities work: `bg-theme-background`, `text-theme-text`, etc.
5. No FOUT when page loads (fonts should load instantly or swap smoothly)
</verification>

<success_criteria>
- globals.css has theme tokens in @theme inline directive
- Default dark theme values in :root
- Theme variant selectors for mac-os, sleek-modern, instagram-reels
- 15 curated fonts loading via next/font/google
- Font variables applied to layout
- All fonts available as CSS variables
</success_criteria>

<output>
After completion, create `.planning/phases/07-theme-system/07-02-SUMMARY.md`
</output>
