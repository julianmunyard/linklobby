---
phase: 06-advanced-cards
plan: 11
type: execute
wave: 3
depends_on: ["06-01", "06-05", "06-06"]
files_modified:
  - src/components/editor/dropdown-card-fields.tsx
  - src/components/editor/card-property-editor.tsx
  - src/components/editor/cards-tab.tsx
autonomous: true

must_haves:
  truths:
    - "Dropdown can be added from card picker"
    - "Dropdown header text is editable"
    - "Dropdown expand/collapse text is customizable"
  artifacts:
    - path: "src/components/editor/dropdown-card-fields.tsx"
      provides: "DropdownCardFields component"
      exports: ["DropdownCardFields"]
    - path: "src/components/editor/cards-tab.tsx"
      provides: "Dropdown option in add card menu"
      contains: "dropdown"
  key_links:
    - from: "src/components/editor/card-property-editor.tsx"
      to: "src/components/editor/dropdown-card-fields.tsx"
      via: "DropdownCardFields import"
      pattern: "DropdownCardFields"
---

<objective>
Add dropdown card to editor with property editing.

Purpose: Allows artists to create and customize dropdown containers from the editor UI.
Output: Dropdown in card picker, editable dropdown properties.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/06-advanced-cards/06-CONTEXT.md
@.planning/phases/06-advanced-cards/06-01-SUMMARY.md
@.planning/phases/06-advanced-cards/06-05-SUMMARY.md
@.planning/phases/06-advanced-cards/06-06-SUMMARY.md
@src/components/editor/card-property-editor.tsx
@src/components/editor/cards-tab.tsx
@src/types/card.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DropdownCardFields Component</name>
  <files>src/components/editor/dropdown-card-fields.tsx</files>
  <action>
Create src/components/editor/dropdown-card-fields.tsx:

```typescript
"use client"

import { Label } from "@/components/ui/label"
import { Input } from "@/components/ui/input"
import type { DropdownCardContent } from "@/types/card"

interface DropdownCardFieldsProps {
  content: Partial<DropdownCardContent>
  onChange: (updates: Record<string, unknown>) => void
}

export function DropdownCardFields({ content, onChange }: DropdownCardFieldsProps) {
  const childCount = content.childCardIds?.length ?? 0

  return (
    <div className="space-y-4">
      {/* Header Text */}
      <div className="space-y-2">
        <Label htmlFor="headerText">Header Text</Label>
        <Input
          id="headerText"
          placeholder="e.g., Music Links"
          value={content.headerText ?? ""}
          onChange={(e) => onChange({ headerText: e.target.value || undefined })}
        />
        <p className="text-xs text-muted-foreground">
          Shown at the top of the dropdown. Falls back to card title if empty.
        </p>
      </div>

      {/* Expand Text */}
      <div className="space-y-2">
        <Label htmlFor="expandText">Expand Text</Label>
        <Input
          id="expandText"
          placeholder="Show more"
          value={content.expandText ?? ""}
          onChange={(e) => onChange({ expandText: e.target.value || undefined })}
        />
      </div>

      {/* Collapse Text */}
      <div className="space-y-2">
        <Label htmlFor="collapseText">Collapse Text</Label>
        <Input
          id="collapseText"
          placeholder="Show less"
          value={content.collapseText ?? ""}
          onChange={(e) => onChange({ collapseText: e.target.value || undefined })}
        />
      </div>

      {/* Info about contents */}
      <div className="pt-4 border-t">
        <p className="text-sm text-muted-foreground">
          <span className="font-medium">{childCount}</span>
          {childCount === 1 ? " card" : " cards"} inside this dropdown.
        </p>
        <p className="text-xs text-muted-foreground mt-1">
          Drag cards into the dropdown in preview to add them, or drag them out to remove.
        </p>
      </div>
    </div>
  )
}
```

Key features:
- Header text customization
- Expand/collapse text customization
- Shows child count info
- Helpful instructions for managing contents
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>DropdownCardFields component created</done>
</task>

<task type="auto">
  <name>Task 2: Add Dropdown to Cards Tab Picker</name>
  <files>src/components/editor/cards-tab.tsx</files>
  <action>
Update cards-tab.tsx to include dropdown in the add card menu:

1. Find the card type options array/list (likely includes hero, horizontal, square, etc.)

2. Add dropdown option with appropriate icon:
```typescript
{ type: "dropdown" as CardType, icon: ChevronDown, label: "Dropdown" }
```

3. Import ChevronDown from lucide-react if not already imported.

4. Make sure the addCard handler passes "dropdown" to the store.

Default content for dropdown should be:
```typescript
{ childCardIds: [] }
```

This is handled in the store's addCard function - may need to add special handling for dropdown to initialize content.childCardIds as empty array.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>Dropdown option added to card picker in cards tab</done>
</task>

<task type="auto">
  <name>Task 3: Integrate DropdownCardFields into Property Editor</name>
  <files>src/components/editor/card-property-editor.tsx</files>
  <action>
Update card-property-editor.tsx to render DropdownCardFields:

1. Import DropdownCardFields:
```typescript
import { DropdownCardFields } from "./dropdown-card-fields"
```

2. Import DropdownCardContent type:
```typescript
import type { DropdownCardContent } from "@/types/card"
```

3. Add conditional render for dropdown type (similar to how video/gallery fields are handled):
```typescript
{card.card_type === "dropdown" && (
  <DropdownCardFields
    content={currentContent as Partial<DropdownCardContent>}
    onChange={handleContentChange}
  />
)}
```

4. Dropdown cards don't need:
   - Image upload (already excluded via CARD_TYPES_NO_IMAGE)
   - Card type picker (dropdown is not convertible)
   - URL field (optional - could hide for dropdown)
   - Text/vertical alignment (doesn't apply)

Consider adding a check to hide some standard fields for dropdown:
```typescript
const hideCommonFields = card.card_type === "dropdown" || card.card_type === "social-icons"
```

Show title field for dropdown (used as fallback header text).
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>DropdownCardFields integrated into property editor</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- Dropdown appears in card picker
- Clicking dropdown creates empty dropdown card
- Dropdown property editor shows header/expand/collapse fields
- Child count displays correctly
</verification>

<success_criteria>
- Artist can add dropdown from card picker
- Header text, expand text, collapse text are editable
- Property editor shows helpful instructions
- Dropdown card renders correctly in preview
</success_criteria>

<output>
After completion, create `.planning/phases/06-advanced-cards/06-11-SUMMARY.md`
</output>
