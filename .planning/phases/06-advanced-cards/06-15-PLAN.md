---
phase: 06-advanced-cards
plan: 15
type: execute
wave: 3
depends_on: ["06-03", "06-14"]
files_modified:
  - src/components/editor/mobile-select-mode.tsx
  - src/components/editor/mobile-fab.tsx
  - src/components/canvas/preview-flow-grid.tsx
autonomous: true

must_haves:
  truths:
    - "Mobile has Select button to enter checkbox mode"
    - "Tapping cards in select mode toggles checkbox"
    - "Selection toolbar shows mobile-friendly actions"
    - "Exit select mode clears selection"
  artifacts:
    - path: "src/components/editor/mobile-select-mode.tsx"
      provides: "Mobile select mode toggle and checkbox UI"
      exports: ["MobileSelectMode", "MobileSelectToggle"]
  key_links:
    - from: "src/components/editor/mobile-select-mode.tsx"
      to: "src/contexts/multi-select-context.tsx"
      via: "useMultiSelectContext"
      pattern: "isSelectMode|enterSelectMode|exitSelectMode"
---

<objective>
Implement mobile checkbox selection mode for bulk card operations.

Purpose: Provides touch-friendly multi-select on mobile where box selection isn't practical.
Output: Mobile select mode with checkbox UI, integrated with existing selection toolbar.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/06-advanced-cards/06-CONTEXT.md
@.planning/phases/06-advanced-cards/06-03-SUMMARY.md
@.planning/phases/06-advanced-cards/06-14-SUMMARY.md
@src/components/editor/mobile-fab.tsx
@src/components/canvas/preview-flow-grid.tsx
@src/contexts/multi-select-context.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Mobile Select Mode Components</name>
  <files>src/components/editor/mobile-select-mode.tsx</files>
  <action>
Create src/components/editor/mobile-select-mode.tsx:

```typescript
"use client"

import { CheckSquare, Square, X } from "lucide-react"
import { Button } from "@/components/ui/button"
import { useMultiSelectContext } from "@/contexts/multi-select-context"
import { cn } from "@/lib/utils"

/**
 * Toggle button to enter/exit select mode on mobile
 */
export function MobileSelectToggle() {
  const { isSelectMode, enterSelectMode, exitSelectMode, selectedCount } = useMultiSelectContext()

  if (isSelectMode) {
    return (
      <Button
        variant="secondary"
        size="sm"
        onClick={exitSelectMode}
        className="h-11"
      >
        <X className="h-4 w-4 mr-2" />
        Exit Select ({selectedCount})
      </Button>
    )
  }

  return (
    <Button
      variant="outline"
      size="sm"
      onClick={enterSelectMode}
      className="h-11"
    >
      <CheckSquare className="h-4 w-4 mr-2" />
      Select
    </Button>
  )
}

/**
 * Checkbox overlay for cards in select mode
 */
interface MobileSelectCheckboxProps {
  cardId: string
  className?: string
}

export function MobileSelectCheckbox({ cardId, className }: MobileSelectCheckboxProps) {
  const { isSelectMode, isSelected, toggleSelect } = useMultiSelectContext()

  if (!isSelectMode) return null

  const checked = isSelected(cardId)

  return (
    <button
      type="button"
      onClick={(e) => {
        e.stopPropagation()
        toggleSelect(cardId)
      }}
      className={cn(
        "absolute top-2 left-2 z-10 w-6 h-6 rounded border-2 flex items-center justify-center transition-colors",
        checked
          ? "bg-primary border-primary text-primary-foreground"
          : "bg-background/80 border-muted-foreground",
        className
      )}
      aria-label={checked ? "Deselect card" : "Select card"}
    >
      {checked && <CheckSquare className="h-4 w-4" />}
      {!checked && <Square className="h-4 w-4 opacity-50" />}
    </button>
  )
}

/**
 * Mobile-optimized selection toolbar
 * Wraps the desktop toolbar with mobile-specific adjustments
 */
export function MobileSelectionBar() {
  const { isSelectMode, selectedCount, clearSelection, exitSelectMode } = useMultiSelectContext()

  if (!isSelectMode || selectedCount === 0) return null

  // Mobile shows simpler bar with "Done" to exit
  return (
    <div className="fixed top-0 left-0 right-0 z-50 bg-background border-b p-2 flex items-center justify-between">
      <span className="text-sm font-medium">
        {selectedCount} selected
      </span>
      <div className="flex gap-2">
        <Button
          variant="ghost"
          size="sm"
          onClick={clearSelection}
          className="h-9"
        >
          Clear
        </Button>
        <Button
          variant="default"
          size="sm"
          onClick={exitSelectMode}
          className="h-9"
        >
          Done
        </Button>
      </div>
    </div>
  )
}
```

Key features:
- MobileSelectToggle: Button to enter/exit select mode
- MobileSelectCheckbox: Overlay checkbox for each card
- MobileSelectionBar: Top bar showing selection count
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>Mobile select mode components created</done>
</task>

<task type="auto">
  <name>Task 2: Add Select Toggle to Mobile FAB/Toolbar</name>
  <files>src/components/editor/mobile-fab.tsx</files>
  <action>
Update mobile-fab.tsx to include Select toggle:

1. Import MobileSelectToggle:
```typescript
import { MobileSelectToggle } from "./mobile-select-mode"
```

2. Add MobileSelectToggle to the mobile toolbar/FAB area. This could be:
   - In the FAB menu
   - In the mobile header/toolbar
   - As a secondary action button

Look at the current structure of mobile-fab.tsx and add the select toggle in an appropriate location.

The toggle should be easily accessible on mobile - likely in the top toolbar area alongside other actions.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>Select toggle added to mobile interface</done>
</task>

<task type="auto">
  <name>Task 3: Add Checkbox Overlay to Preview Cards</name>
  <files>src/components/canvas/preview-flow-grid.tsx, src/components/canvas/preview-sortable-card.tsx</files>
  <action>
Update preview cards to show checkboxes in select mode:

1. If preview-flow-grid.tsx or preview-sortable-card.tsx exist, update them to include MobileSelectCheckbox.

2. Import MobileSelectCheckbox:
```typescript
import { MobileSelectCheckbox } from "@/components/editor/mobile-select-mode"
```

3. Add checkbox to each card wrapper:
```typescript
<div className="relative">
  <MobileSelectCheckbox cardId={card.id} />
  {/* existing card content */}
</div>
```

4. In select mode, tapping the card should toggle selection instead of opening property editor:
```typescript
const { isSelectMode, toggleSelect } = useMultiSelectContext()

const handleCardClick = () => {
  if (isSelectMode) {
    toggleSelect(card.id)
  } else {
    // Open property editor
    onSelectCard?.(card.id)
  }
}
```

Also add MobileSelectionBar to the preview panel header when in select mode.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>Checkbox overlay added to preview cards</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- Select button appears on mobile toolbar
- Tapping Select enters checkbox mode
- Cards show checkbox overlay in select mode
- Tapping checkbox toggles selection
- Exit/Done clears selection and exits mode
</verification>

<success_criteria>
- Mobile has accessible Select button
- Checkbox mode shows checkboxes on all cards
- Tapping cards in select mode toggles selection
- Selection count visible
- Can exit select mode via Done/Exit button
- Selection toolbar actions work on mobile
</success_criteria>

<output>
After completion, create `.planning/phases/06-advanced-cards/06-15-SUMMARY.md`
</output>
