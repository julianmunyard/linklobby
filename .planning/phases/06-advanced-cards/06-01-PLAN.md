---
phase: 06-advanced-cards
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/card.ts
  - src/stores/page-store.ts
  - src/lib/ordering.ts
autonomous: true

must_haves:
  truths:
    - "Dropdown card type exists in type system"
    - "Cards can have a parent dropdown ID"
    - "Store can add cards to dropdowns"
  artifacts:
    - path: "src/types/card.ts"
      provides: "DropdownCardContent interface"
      contains: "childCardIds"
    - path: "src/stores/page-store.ts"
      provides: "moveCardToDropdown and removeCardFromDropdown actions"
  key_links:
    - from: "src/stores/page-store.ts"
      to: "src/types/card.ts"
      via: "DropdownCardContent import"
      pattern: "DropdownCardContent"
---

<objective>
Define dropdown card types and extend store with dropdown management actions.

Purpose: Establishes type safety and state management for dropdown containers before UI implementation.
Output: Extended Card types with DropdownCardContent, store actions for managing card-dropdown relationships.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-advanced-cards/06-CONTEXT.md
@.planning/phases/06-advanced-cards/06-RESEARCH.md
@src/types/card.ts
@src/stores/page-store.ts
@src/lib/ordering.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Dropdown Card Content Type</name>
  <files>src/types/card.ts</files>
  <action>
Add DropdownCardContent interface to types/card.ts:

```typescript
export interface DropdownCardContent {
  headerText?: string        // Custom header (fallback to card.title)
  expandText?: string        // "Show more" text (optional)
  collapseText?: string      // "Show less" text (optional)
  childCardIds: string[]     // IDs of cards inside this dropdown (ordering)
}
```

Add type guard:
```typescript
export function isDropdownContent(content: unknown): content is DropdownCardContent {
  return typeof content === 'object' && content !== null && 'childCardIds' in content
}
```

Update CardContent union type to include DropdownCardContent.

Confirm dropdown is already in CardType union (it is) and CARD_TYPE_SIZING has null for dropdown (it does).
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>DropdownCardContent interface exists with childCardIds array and type guard</done>
</task>

<task type="auto">
  <name>Task 2: Add Parent Dropdown Field to Card</name>
  <files>src/types/card.ts</files>
  <action>
Add optional parentDropdownId field to Card interface:

```typescript
export interface Card {
  // ... existing fields
  parentDropdownId?: string | null  // If card is inside a dropdown, this is the dropdown's ID
}
```

This allows cards to know which dropdown they belong to. Cards on main canvas have null/undefined.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>Card interface has optional parentDropdownId field</done>
</task>

<task type="auto">
  <name>Task 3: Add Dropdown Store Actions</name>
  <files>src/stores/page-store.ts</files>
  <action>
Add three new actions to PageState interface and implementation:

1. `moveCardToDropdown(cardId: string, dropdownId: string)`:
   - Find the card and dropdown
   - If card was already in a different dropdown, remove from its childCardIds
   - Add cardId to dropdown's content.childCardIds array (at end)
   - Set card.parentDropdownId = dropdownId
   - Generate new sortKey for card (within dropdown context - use generateAppendKey with dropdown's children only)
   - Set hasChanges = true

2. `removeCardFromDropdown(cardId: string)`:
   - Find the card's parentDropdownId
   - Remove cardId from that dropdown's content.childCardIds
   - Set card.parentDropdownId = null
   - Generate new sortKey for card on main canvas (use generateAppendKey with main canvas cards)
   - Set hasChanges = true

3. `addCardToDropdown(dropdownId: string, type: CardType, size?: CardSize)`:
   - Same as addCard but sets parentDropdownId = dropdownId
   - Also adds the new card ID to dropdown's content.childCardIds
   - Returns the new card ID

Import DropdownCardContent from types/card.ts for type safety.

Use existing fractional-indexing helpers from lib/ordering.ts.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>Store has moveCardToDropdown, removeCardFromDropdown, and addCardToDropdown actions</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with no errors
- DropdownCardContent has childCardIds array
- Card has optional parentDropdownId
- Store has dropdown management actions
</verification>

<success_criteria>
- Type system supports dropdown as container with child cards
- Cards can track their parent dropdown
- Store can manage card-dropdown relationships
- No runtime regressions (existing tests pass)
</success_criteria>

<output>
After completion, create `.planning/phases/06-advanced-cards/06-01-SUMMARY.md`
</output>
