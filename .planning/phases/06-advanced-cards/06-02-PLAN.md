---
phase: 06-advanced-cards
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/card.ts
  - src/hooks/use-game-loop.ts
  - src/hooks/use-swipe-controls.ts
autonomous: true

must_haves:
  truths:
    - "Game card type exists in type system"
    - "Game loop hook provides requestAnimationFrame management"
    - "Swipe controls hook detects swipe direction on mobile"
  artifacts:
    - path: "src/types/card.ts"
      provides: "GameCardContent interface and GameType type"
      contains: "gameType"
    - path: "src/hooks/use-game-loop.ts"
      provides: "useGameLoop hook"
      exports: ["useGameLoop"]
    - path: "src/hooks/use-swipe-controls.ts"
      provides: "useSwipeControls hook"
      exports: ["useSwipeControls"]
  key_links:
    - from: "src/hooks/use-game-loop.ts"
      to: "requestAnimationFrame"
      via: "game loop implementation"
      pattern: "requestAnimationFrame"
---

<objective>
Define game card types and create reusable hooks for game loop and touch controls.

Purpose: Establishes foundation for all three game implementations with shared game loop and control hooks.
Output: GameCardContent type, useGameLoop hook for 60fps animation, useSwipeControls hook for mobile.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/06-advanced-cards/06-CONTEXT.md
@.planning/phases/06-advanced-cards/06-RESEARCH.md
@src/types/card.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Game Card Content Type</name>
  <files>src/types/card.ts</files>
  <action>
Add GameType and GameCardContent to types/card.ts:

```typescript
export type GameType = 'snake' | 'breakout' | 'flappy'

export interface GameCardContent {
  gameType: GameType
}
```

Add type guard:
```typescript
export function isGameContent(content: unknown): content is GameCardContent {
  return typeof content === 'object' && content !== null && 'gameType' in content
}
```

Update CardContent union type to include GameCardContent.

Add GAME_TYPE_INFO constant for UI display:
```typescript
export const GAME_TYPE_INFO: Record<GameType, { label: string; description: string }> = {
  snake: { label: 'Snake', description: 'Classic snake game' },
  breakout: { label: 'Breakout', description: 'Break the bricks' },
  flappy: { label: 'Flappy', description: 'Tap to fly' },
}
```
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>GameType and GameCardContent types exist with type guard and info constant</done>
</task>

<task type="auto">
  <name>Task 2: Create useGameLoop Hook</name>
  <files>src/hooks/use-game-loop.ts</files>
  <action>
Create src/hooks/use-game-loop.ts with a reusable game loop hook:

```typescript
"use client"

import { useEffect, useRef, useCallback } from "react"

interface UseGameLoopOptions {
  onUpdate: (deltaTime: number) => void
  onDraw: (ctx: CanvasRenderingContext2D) => void
  isPlaying: boolean
}

export function useGameLoop({ onUpdate, onDraw, isPlaying }: UseGameLoopOptions) {
  const canvasRef = useRef<HTMLCanvasElement>(null)
  const frameIdRef = useRef<number>(0)
  const lastTimeRef = useRef<number>(0)

  useEffect(() => {
    if (!isPlaying || !canvasRef.current) {
      return
    }

    const canvas = canvasRef.current
    const ctx = canvas.getContext("2d")
    if (!ctx) return

    const gameLoop = (timestamp: number) => {
      const deltaTime = timestamp - lastTimeRef.current
      lastTimeRef.current = timestamp

      // Cap deltaTime to prevent huge jumps after tab switch (max 100ms = 10fps minimum)
      const cappedDelta = Math.min(deltaTime, 100)

      onUpdate(cappedDelta)
      onDraw(ctx)

      frameIdRef.current = requestAnimationFrame(gameLoop)
    }

    // Reset lastTime on start
    lastTimeRef.current = performance.now()
    frameIdRef.current = requestAnimationFrame(gameLoop)

    return () => {
      if (frameIdRef.current) {
        cancelAnimationFrame(frameIdRef.current)
      }
    }
  }, [isPlaying, onUpdate, onDraw])

  return canvasRef
}
```

Key features:
- Accepts onUpdate (game logic) and onDraw (rendering) callbacks
- Caps deltaTime to prevent physics explosions after tab switch
- Returns canvas ref for component to use
- Properly cleans up animation frame on unmount
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>useGameLoop hook exists with proper animation frame management</done>
</task>

<task type="auto">
  <name>Task 3: Create useSwipeControls Hook</name>
  <files>src/hooks/use-swipe-controls.ts</files>
  <action>
Create src/hooks/use-swipe-controls.ts for mobile game controls:

```typescript
"use client"

import { useRef, useCallback } from "react"

export type SwipeDirection = "up" | "down" | "left" | "right"

interface UseSwipeControlsOptions {
  onSwipe: (direction: SwipeDirection) => void
  minSwipeDistance?: number
}

export function useSwipeControls({
  onSwipe,
  minSwipeDistance = 50,
}: UseSwipeControlsOptions) {
  const touchStartRef = useRef({ x: 0, y: 0 })

  const handleTouchStart = useCallback((e: React.TouchEvent) => {
    touchStartRef.current = {
      x: e.touches[0].clientX,
      y: e.touches[0].clientY,
    }
  }, [])

  const handleTouchEnd = useCallback(
    (e: React.TouchEvent) => {
      const deltaX = e.changedTouches[0].clientX - touchStartRef.current.x
      const deltaY = e.changedTouches[0].clientY - touchStartRef.current.y

      // Determine if swipe is primarily horizontal or vertical
      if (Math.abs(deltaX) > Math.abs(deltaY)) {
        // Horizontal swipe
        if (Math.abs(deltaX) > minSwipeDistance) {
          onSwipe(deltaX > 0 ? "right" : "left")
        }
      } else {
        // Vertical swipe
        if (Math.abs(deltaY) > minSwipeDistance) {
          onSwipe(deltaY > 0 ? "down" : "up")
        }
      }
    },
    [onSwipe, minSwipeDistance]
  )

  return {
    handleTouchStart,
    handleTouchEnd,
  }
}
```

This hook:
- Tracks touch start position
- Calculates swipe direction on touch end
- Requires minimum distance to register as swipe (default 50px)
- Returns handlers to attach to touch-enabled elements
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>useSwipeControls hook exists with swipe direction detection</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with no errors
- GameCardContent interface has gameType field
- useGameLoop hook exported and typed correctly
- useSwipeControls hook exported and typed correctly
</verification>

<success_criteria>
- Game type definitions ready for game implementations
- Game loop hook handles requestAnimationFrame correctly
- Swipe controls hook detects all four directions
- Hooks are reusable across all three games
</success_criteria>

<output>
After completion, create `.planning/phases/06-advanced-cards/06-02-SUMMARY.md`
</output>
