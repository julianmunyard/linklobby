---
phase: 06-advanced-cards
plan: 05
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/components/cards/dropdown-card.tsx
  - src/components/cards/card-renderer.tsx
  - src/app/globals.css
autonomous: true

must_haves:
  truths:
    - "Dropdown card renders with header and chevron"
    - "Clicking header expands/collapses content"
    - "Expand/collapse animates smoothly"
    - "Badge shows child count"
  artifacts:
    - path: "src/components/cards/dropdown-card.tsx"
      provides: "DropdownCard component"
      exports: ["DropdownCard"]
      min_lines: 50
    - path: "src/components/cards/card-renderer.tsx"
      provides: "Dropdown case in switch"
      contains: "case \"dropdown\""
  key_links:
    - from: "src/components/cards/dropdown-card.tsx"
      to: "@radix-ui/react-collapsible"
      via: "Collapsible import"
      pattern: "Collapsible"
    - from: "src/components/cards/card-renderer.tsx"
      to: "src/components/cards/dropdown-card.tsx"
      via: "DropdownCard import"
      pattern: "DropdownCard"
---

<objective>
Create the Dropdown Card UI component with Radix Collapsible for expand/collapse animation.

Purpose: Renders dropdown containers that can hold other cards with smooth accordion behavior.
Output: DropdownCard component integrated into card-renderer.tsx.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/06-advanced-cards/06-CONTEXT.md
@.planning/phases/06-advanced-cards/06-RESEARCH.md
@.planning/phases/06-advanced-cards/06-01-SUMMARY.md
@src/types/card.ts
@src/components/cards/card-renderer.tsx
@src/components/ui/collapsible.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DropdownCard Component</name>
  <files>src/components/cards/dropdown-card.tsx</files>
  <action>
Create src/components/cards/dropdown-card.tsx:

```typescript
"use client"

import { useState } from "react"
import { ChevronDown } from "lucide-react"
import {
  Collapsible,
  CollapsibleContent,
  CollapsibleTrigger,
} from "@/components/ui/collapsible"
import { cn } from "@/lib/utils"
import type { Card, DropdownCardContent } from "@/types/card"
import { isDropdownContent } from "@/types/card"

interface DropdownCardProps {
  card: Card
  isPreview?: boolean
  children?: React.ReactNode  // Child cards rendered by parent
}

export function DropdownCard({ card, isPreview = false, children }: DropdownCardProps) {
  // Start collapsed as per CONTEXT.md
  const [isOpen, setIsOpen] = useState(false)

  const content = isDropdownContent(card.content)
    ? card.content
    : { childCardIds: [] } as DropdownCardContent

  const childCount = content.childCardIds?.length ?? 0
  const headerText = content.headerText || card.title || "Dropdown"
  const expandText = content.expandText || "Show more"
  const collapseText = content.collapseText || "Show less"

  return (
    <div className="w-full">
      <Collapsible open={isOpen} onOpenChange={setIsOpen}>
        <CollapsibleTrigger asChild>
          <button
            className={cn(
              "w-full flex items-center justify-between p-4 rounded-lg",
              "bg-card border hover:bg-accent/50 transition-colors",
              "text-left cursor-pointer"
            )}
          >
            <div className="flex items-center gap-2">
              <span className="font-medium">{headerText}</span>
              {childCount > 0 && (
                <span className="text-xs text-muted-foreground bg-muted px-2 py-0.5 rounded-full">
                  {childCount} {childCount === 1 ? "item" : "items"}
                </span>
              )}
            </div>
            <div className="flex items-center gap-2 text-muted-foreground">
              <span className="text-xs">
                {isOpen ? collapseText : expandText}
              </span>
              <ChevronDown
                className={cn(
                  "h-4 w-4 transition-transform duration-200",
                  isOpen && "rotate-180"
                )}
              />
            </div>
          </button>
        </CollapsibleTrigger>
        <CollapsibleContent className="dropdown-content overflow-hidden">
          <div className="pt-2 pl-4 space-y-2">
            {children}
            {!children && childCount === 0 && (
              <p className="text-sm text-muted-foreground p-4 border border-dashed rounded-lg text-center">
                Drag cards here or add from editor
              </p>
            )}
          </div>
        </CollapsibleContent>
      </Collapsible>
    </div>
  )
}
```

Key features:
- Uses Radix Collapsible for accessible expand/collapse
- Starts collapsed (per CONTEXT.md)
- Shows item count badge
- Custom expand/collapse text support
- Empty state message
- Children slot for nested card rendering
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>DropdownCard component renders with collapsible behavior</done>
</task>

<task type="auto">
  <name>Task 2: Add CSS Animation for Collapsible</name>
  <files>src/app/globals.css</files>
  <action>
Add animation keyframes for dropdown content to globals.css:

```css
/* Dropdown Card Animations */
.dropdown-content[data-state="open"] {
  animation: slideDown 200ms ease-out;
}

.dropdown-content[data-state="closed"] {
  animation: slideUp 200ms ease-out;
}

@keyframes slideDown {
  from {
    height: 0;
    opacity: 0;
  }
  to {
    height: var(--radix-collapsible-content-height);
    opacity: 1;
  }
}

@keyframes slideUp {
  from {
    height: var(--radix-collapsible-content-height);
    opacity: 1;
  }
  to {
    height: 0;
    opacity: 0;
  }
}
```

Note: Radix Collapsible provides --radix-collapsible-content-height CSS variable for smooth height animation.
  </action>
  <verify>CSS is valid and animations run smoothly (manual verification during integration)</verify>
  <done>Slide animations defined in globals.css</done>
</task>

<task type="auto">
  <name>Task 3: Integrate DropdownCard into CardRenderer</name>
  <files>src/components/cards/card-renderer.tsx</files>
  <action>
Update card-renderer.tsx to render DropdownCard:

1. Import DropdownCard:
```typescript
import { DropdownCard } from "./dropdown-card"
```

2. Add case for dropdown in switch statement:
```typescript
case "dropdown":
  return <DropdownCard card={card} isPreview={isPreview} />
```

Note: Children will be passed by the parent component (flow-grid) in a later plan. For now, the dropdown will render empty state if no children prop is provided.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>CardRenderer handles dropdown card type</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- DropdownCard component exists and exports correctly
- CardRenderer has dropdown case
- CSS animations defined in globals.css
</verification>

<success_criteria>
- Dropdown card renders with header, badge, and chevron
- Clicking header toggles expand/collapse
- Animation is smooth (200ms slide)
- Empty state shows "Drag cards here" message
- Component accepts children for nested cards
</success_criteria>

<output>
After completion, create `.planning/phases/06-advanced-cards/06-05-SUMMARY.md`
</output>
