---
phase: 12.6-security-hardening
plan: 06
subsystem: auth
tags: [supabase, session-management, cookie-consent, gdpr, pixels]

# Dependency graph
requires:
  - phase: 12.6-04
    provides: Settings page structure with Profile/Account/Security sections
  - phase: 12.6-05
    provides: Security section with TwoFactorStatus component
provides:
  - SessionManagement component with sign out other devices / sign out everywhere
  - Cookie consent banner wired to public pages conditional on pixel configuration
  - Pixel gating behind explicit user consent (GDPR compliant)
affects: [public-page, settings, pixels, analytics]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "supabase.auth.signOut({ scope: 'others' }) for per-device session revocation"
    - "supabase.auth.signOut({ scope: 'global' }) for full session revocation"
    - "Pixel rendering gated behind consent-granted custom event"

key-files:
  created:
    - src/components/auth/session-list.tsx
  modified:
    - src/app/(dashboard)/settings/page.tsx
    - src/components/legal/cookie-consent-banner.tsx
    - src/app/[username]/page.tsx

key-decisions:
  - "Use browser confirm() dialogs for sign out confirmation — no modal dependency needed for simple destructive actions"
  - "Pass themeColors explicitly to CookieConsentBanner from public page to ensure theme match even before scroll (CSS vars may not be available on mount)"
  - "Conditional banner render uses already-extracted facebookPixelId/gaMeasurementId variables — no new data fetching required"

patterns-established:
  - "Session management: two-tier — revoke others (scope: others) vs revoke all (scope: global + redirect)"
  - "GDPR pixel gating: banner conditional on pixel config, PixelLoader gates rendering on consent-granted event"

# Metrics
duration: 10min
completed: 2026-02-25
---

# Phase 12.6 Plan 06: Session Management and Cookie Consent Summary

**Session management UI with scoped Supabase sign-out, and GDPR-compliant cookie consent banner wired to public pages with pixel gating**

## Performance

- **Duration:** ~10 min
- **Started:** 2026-02-25T08:22:04Z
- **Completed:** 2026-02-25T08:32:00Z
- **Tasks:** 2
- **Files modified:** 4

## Accomplishments

- SessionManagement component with "Sign out all other devices" (scope: others) and "Sign out everywhere" (scope: global) actions, rendered in Settings Security section
- Cookie consent banner wired to public pages, conditionally shown only when artist has Facebook Pixel or Google Analytics configured
- Verified PixelLoader already gates pixel rendering behind consent-granted event — no changes needed, GDPR compliance confirmed

## Task Commits

Each task was committed atomically:

1. **Task 1: Create session management component and add to settings** - `0d8daea` (feat)
2. **Task 2: Wire cookie consent banner to public pages with pixel gating** - `af11743` (feat)

**Plan metadata:** (docs commit follows)

## Files Created/Modified

- `src/components/auth/session-list.tsx` - SessionManagement client component with two sign-out scope actions, loading states, success/error feedback
- `src/app/(dashboard)/settings/page.tsx` - Added SessionManagement import and render below TwoFactorStatus in Security section
- `src/components/legal/cookie-consent-banner.tsx` - Removed "Cookie Preferences (coming soon)" placeholder text
- `src/app/[username]/page.tsx` - Added CookieConsentBanner import and conditional render when facebookPixelId or gaMeasurementId is present

## Decisions Made

- Used browser `confirm()` for sign-out confirmation dialogs — simple and dependency-free for destructive actions without modal complexity
- Pass theme colors explicitly from public page to CookieConsentBanner rather than relying solely on CSS custom properties — more reliable since CSS vars may not be available on first mount
- Cookie consent banner conditional uses the already-extracted pixel ID variables (`facebookPixelId`, `gaMeasurementId`) — no additional database queries needed

## Deviations from Plan

None - plan executed exactly as written. PixelLoader consent gating was already implemented and verified (no changes required).

## Issues Encountered

None.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- Session management complete and integrated into Security settings
- GDPR cookie consent flow complete end-to-end: banner renders when pixels configured, accepts/declines dispatch events, PixelLoader gates on consent-granted
- Phase 12.6 Plan 07 (final plan) can proceed

---
*Phase: 12.6-security-hardening*
*Completed: 2026-02-25*
