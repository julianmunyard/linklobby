---
phase: 12.6-security-hardening
plan: 03
subsystem: auth
tags: [supabase, oauth, google, password-reset, next-auth]

# Dependency graph
requires:
  - phase: 12.6-security-hardening
    provides: auth infrastructure (Supabase client, login/signup forms already in place)
provides:
  - Google OAuth button component (reusable, Supabase signInWithOAuth)
  - Forgot password flow (/forgot-password page + form)
  - Reset password flow (/reset-password page + form)
  - Updated auth callback handling type=recovery redirects
affects: [12.6-04, 12.6-05, future-auth-hardening]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "OAuth via Supabase signInWithOAuth with window.location.origin/auth/callback redirectTo"
    - "Password reset via Supabase resetPasswordForEmail with type=recovery in redirectTo query param"
    - "Auth callback parses type param: recovery -> /reset-password, else -> next param (default /editor)"
    - "Success states shown inline in forms (no toast), with 2s delay redirect for password update"

key-files:
  created:
    - src/components/auth/google-oauth-button.tsx
    - src/app/(auth)/forgot-password/forgot-password-form.tsx
    - src/app/(auth)/forgot-password/page.tsx
    - src/app/(auth)/reset-password/reset-password-form.tsx
    - src/app/(auth)/reset-password/page.tsx
  modified:
    - src/app/(auth)/login/login-form.tsx
    - src/app/(auth)/signup/signup-form.tsx
    - src/app/auth/callback/route.ts

key-decisions:
  - "GoogleOAuthButton is a standalone 'use client' component — reusable on both login and signup without prop drilling"
  - "Forgot password redirectTo includes type=recovery and next=/reset-password so callback can distinguish from normal OAuth"
  - "Auth callback checks type=recovery before checking next param — recovery takes absolute precedence"
  - "Reset password form uses 2s setTimeout before router.push('/login') — gives user confirmation the update worked"

patterns-established:
  - "OAuth pattern: signInWithOAuth with window.location.origin/auth/callback as redirectTo"
  - "Recovery pattern: resetPasswordForEmail sets type=recovery in redirectTo, callback routes accordingly"

# Metrics
duration: 12min
completed: 2026-02-25
---

# Phase 12.6 Plan 03: Google OAuth + Password Reset Summary

**Google OAuth button on login/signup pages, complete forgot/reset password flows, and auth callback recovery routing via Supabase**

## Performance

- **Duration:** ~12 min
- **Started:** 2026-02-25T08:02:24Z
- **Completed:** 2026-02-25T08:14:00Z
- **Tasks:** 2
- **Files modified:** 8 (3 modified, 5 created)

## Accomplishments

- GoogleOAuthButton component using Supabase signInWithOAuth, placed on login and signup forms with visual "or" divider
- "Forgot password?" link added to login form below password label
- Forgot password page at /forgot-password with email input and success state
- Reset password page at /reset-password with new password + confirm fields (zod validation), success state with 2s redirect
- Auth callback updated to detect type=recovery and route to /reset-password instead of /editor

## Task Commits

Each task was committed atomically:

1. **Task 1: Create Google OAuth button and add to login/signup forms** - `8f3a945` (feat)
2. **Task 2: Create forgot-password page, reset-password page, and update auth callback** - `4e0f53f` (feat)

**Plan metadata:** (docs commit pending)

## Files Created/Modified

- `src/components/auth/google-oauth-button.tsx` - Reusable Google OAuth button, Supabase signInWithOAuth, loading state
- `src/app/(auth)/login/login-form.tsx` - Added GoogleOAuthButton + "or" divider, "Forgot password?" link
- `src/app/(auth)/signup/signup-form.tsx` - Added GoogleOAuthButton + "or" divider
- `src/app/(auth)/forgot-password/forgot-password-form.tsx` - Email form, resetPasswordForEmail, success state
- `src/app/(auth)/forgot-password/page.tsx` - Page wrapper
- `src/app/(auth)/reset-password/reset-password-form.tsx` - New password + confirm form (zod), updateUser, success redirect
- `src/app/(auth)/reset-password/page.tsx` - Page wrapper
- `src/app/auth/callback/route.ts` - Added type param parsing: type=recovery routes to /reset-password

## Decisions Made

- GoogleOAuthButton is a standalone `'use client'` component — reusable on both login and signup without prop drilling
- Forgot password `redirectTo` includes `type=recovery&next=/reset-password` so the auth callback can distinguish password recovery from normal OAuth flows
- Auth callback checks `type === 'recovery'` before falling through to `next` param — recovery always wins
- Reset password form shows success state inline with 2s delay before `router.push('/login')` — gives user confirmation before redirect

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## User Setup Required

**External services require manual configuration for Google OAuth:**

1. Create OAuth 2.0 credentials in Google Cloud Console
2. Add authorized redirect URI: `https://<your-supabase-project>.supabase.co/auth/v1/callback`
3. Enable the Google provider in Supabase Dashboard (Authentication > Providers > Google) and paste Client ID + Client Secret

Password reset works without any additional setup — it uses the existing Supabase email service.

## Next Phase Readiness

- Google OAuth button is live on both login and signup — works as soon as Google Cloud credentials are added to Supabase
- Forgot/reset password flow is fully functional end-to-end with no additional configuration
- Auth callback cleanly handles both OAuth and recovery flows

---
*Phase: 12.6-security-hardening*
*Completed: 2026-02-25*
