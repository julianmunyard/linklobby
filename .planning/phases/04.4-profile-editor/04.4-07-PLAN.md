---
phase: 04.4-profile-editor
plan: 07
type: execute
wave: 3
depends_on: ["04.4-04"]
files_modified:
  - src/components/preview/profile-header.tsx
  - src/components/preview/preview-page.tsx
autonomous: false

must_haves:
  truths:
    - "Profile header renders in preview iframe"
    - "Live preview updates as profile is edited"
    - "Profile layout (Classic/Hero) changes header appearance"
    - "Social icons display when toggle is ON"
  artifacts:
    - path: "src/components/preview/profile-header.tsx"
      provides: "Profile header component for preview"
      exports: ["ProfileHeader"]
  key_links:
    - from: "src/components/preview/preview-page.tsx"
      to: "src/components/preview/profile-header.tsx"
      via: "imports ProfileHeader"
      pattern: "import.*ProfileHeader"
    - from: "src/components/preview/profile-header.tsx"
      to: "src/stores/profile-store.ts"
      via: "uses useProfileStore"
      pattern: "useProfileStore"
---

<objective>
Create profile header preview component and wire it into the preview iframe.

Purpose: Artists need to see their profile changes reflected live in the preview - this completes the edit/preview feedback loop.
Output: ProfileHeader component that renders avatar, title, and social icons based on profile store state.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/04.4-profile-editor/04.4-CONTEXT.md
@.planning/phases/04.4-profile-editor/04.4-04-SUMMARY.md
@src/components/preview/preview-page.tsx
@src/stores/profile-store.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ProfileHeader preview component</name>
  <files>src/components/preview/profile-header.tsx</files>
  <action>
Create ProfileHeader component for the preview iframe:

1. Imports:
   - useProfileStore
   - Profile types
   - PLATFORM_ICONS mapping (same as social-icons-editor)
   - User icon from lucide-react (avatar placeholder)
   - Image from next/image (for avatar/logo)

2. Get profile state:
```typescript
const {
  displayName,
  avatarUrl,
  titleStyle,
  titleSize,
  logoUrl,
  profileLayout,
  showSocialIcons,
  socialIcons,
} = useProfileStore()
```

3. Render based on profileLayout:

**Classic layout:**
```tsx
<div className="flex flex-col items-center gap-4 p-6">
  {/* Avatar - small circle */}
  <div className="w-20 h-20 rounded-full bg-muted overflow-hidden">
    {avatarUrl ? (
      <Image src={avatarUrl} alt="" fill className="object-cover" />
    ) : (
      <div className="w-full h-full flex items-center justify-center">
        <User className="w-10 h-10 text-muted-foreground" />
      </div>
    )}
  </div>

  {/* Title */}
  {titleStyle === 'text' && displayName && (
    <h1 className={cn(
      "font-bold text-center",
      titleSize === 'large' ? "text-2xl" : "text-lg"
    )}>
      {displayName}
    </h1>
  )}

  {titleStyle === 'logo' && logoUrl && (
    <Image src={logoUrl} alt="" width={200} height={50} className="object-contain" />
  )}

  {/* Social Icons */}
  {showSocialIcons && socialIcons.length > 0 && (
    <div className="flex gap-3">
      {socialIcons.map(icon => {
        const Icon = PLATFORM_ICONS[icon.platform]
        return (
          <a
            key={icon.id}
            href={icon.url}
            target="_blank"
            rel="noopener noreferrer"
            className="text-muted-foreground hover:text-foreground transition-colors"
          >
            <Icon className="w-5 h-5" />
          </a>
        )
      })}
    </div>
  )}
</div>
```

**Hero layout:**
```tsx
<div className="relative">
  {/* Avatar - larger, possibly banner-style */}
  <div className="w-full aspect-[3/1] bg-muted overflow-hidden">
    {avatarUrl ? (
      <Image src={avatarUrl} alt="" fill className="object-cover" />
    ) : (
      <div className="w-full h-full flex items-center justify-center">
        <User className="w-20 h-20 text-muted-foreground" />
      </div>
    )}
  </div>

  {/* Title + Social overlaid or below */}
  <div className="p-4 text-center">
    {/* Title rendering same as classic */}
    {/* Social icons same as classic */}
  </div>
</div>
```

4. Add transition for smooth updates (per CONTEXT.md):
```tsx
<motion.div
  initial={{ opacity: 0.8 }}
  animate={{ opacity: 1 }}
  transition={{ duration: 0.2 }}
>
  {/* header content */}
</motion.div>
```

Or use CSS transition:
```tsx
<div className="transition-opacity duration-200">
```

5. Export ProfileHeader
  </action>
  <verify>`npx tsc --noEmit` passes</verify>
  <done>ProfileHeader renders avatar, title, social icons based on layout</done>
</task>

<task type="auto">
  <name>Task 2: Wire ProfileHeader into preview page</name>
  <files>src/components/preview/preview-page.tsx</files>
  <action>
Add ProfileHeader to the preview page:

1. Import ProfileHeader:
```typescript
import { ProfileHeader } from "./profile-header"
```

2. Locate where cards are rendered in preview-page.tsx

3. Add ProfileHeader ABOVE the cards section:
```tsx
<div className="...">
  {/* Profile Header at top */}
  <ProfileHeader />

  {/* Cards below */}
  <div className="...">
    {sortedCards.map(card => ...)}
  </div>
</div>
```

4. Ensure proper spacing between header and cards

5. Test live updates:
   - Changes in editor should reflect immediately in preview
   - No page refresh needed (Zustand reactivity)
  </action>
  <verify>`npm run dev` - profile changes appear live in preview</verify>
  <done>ProfileHeader appears in preview above cards, updates live</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete profile editor with live preview:
- Design tab with Header section
- Profile photo upload with crop
- Layout toggle (Classic/Hero)
- Title style (Text/Logo) with size picker
- Social icons with add/remove/reorder
- Live preview updates
  </what-built>
  <how-to-verify>
1. Open dashboard editor at http://localhost:3000/dashboard/edit
2. Click "Design" tab
3. Verify Header section shows:
   - Profile photo circle with Edit
   - Layout: Classic / Hero toggle
   - Title Style: Text / Logo toggle
   - Title Size: Small / Large (when Text selected)
   - Display Name input (when Text selected)
   - Social Icons toggle + list + Add button

4. Test profile photo:
   - Click Edit on photo
   - Upload an image
   - Crop dialog should appear with FREE/RECTANGLE/SQUARE/RESET
   - Save and verify photo appears in preview

5. Test layout toggle:
   - Switch between Classic and Hero
   - Preview header layout should change

6. Test title:
   - Type display name - appears in preview
   - Change size - preview updates
   - Switch to Logo, upload logo - appears in preview

7. Test social icons:
   - Toggle ON, add Instagram icon with URL
   - Icon appears in preview header
   - Drag to reorder multiple icons
   - Remove icon

8. Verify live preview:
   - All changes reflect immediately (no page refresh)
   - Subtle fade transition on updates (if implemented)
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
- `npm run build` passes
- ProfileHeader renders in preview iframe
- Profile store changes trigger preview updates
- Classic layout shows centered circle avatar
- Hero layout shows larger/banner avatar
- Social icons display in row when toggle ON
</verification>

<success_criteria>
- Profile header visible at top of preview
- Layout toggle changes preview appearance (Classic vs Hero)
- Title shows as text or logo based on titleStyle
- Social icons render when showSocialIcons is true
- Live updates: editing immediately reflects in preview
- Human verification confirms full feature works end-to-end
</success_criteria>

<output>
After completion, create `.planning/phases/04.4-profile-editor/04.4-07-SUMMARY.md`
</output>
