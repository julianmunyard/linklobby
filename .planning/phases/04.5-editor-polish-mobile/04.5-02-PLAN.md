---
phase: 04.5-editor-polish-mobile
plan: 02
type: execute
wave: 2
depends_on: ["04.5-01"]
files_modified:
  - src/components/editor/mobile-bottom-sheet.tsx
  - src/components/editor/editor-layout.tsx
  - src/components/editor/mobile-fab.tsx
  - src/components/editor/cards-tab.tsx
  - src/components/editor/editor-panel.tsx
autonomous: true

must_haves:
  truths:
    - "Editor shows bottom sheet on mobile instead of side panel"
    - "Preview stays visible behind bottom sheet while editing"
    - "Tapping a card in preview opens property editor in bottom sheet"
    - "FAB button visible on mobile for adding cards"
    - "Tablets in landscape get desktop layout, portrait gets mobile"
  artifacts:
    - path: "src/components/editor/mobile-bottom-sheet.tsx"
      provides: "Mobile editor wrapper using Drawer"
      exports: ["MobileBottomSheet"]
    - path: "src/components/editor/mobile-fab.tsx"
      provides: "Floating action button for mobile"
      exports: ["MobileFAB"]
    - path: "src/components/editor/editor-layout.tsx"
      provides: "Responsive layout switching"
      contains: "useIsMobileLayout"
  key_links:
    - from: "src/components/editor/editor-layout.tsx"
      to: "src/hooks/use-media-query.ts"
      via: "useIsMobileLayout hook"
      pattern: "useIsMobileLayout"
    - from: "src/components/editor/mobile-bottom-sheet.tsx"
      to: "src/components/ui/drawer.tsx"
      via: "Drawer component import"
      pattern: "Drawer.*DrawerContent"
    - from: "src/components/editor/editor-layout.tsx"
      to: "src/components/editor/mobile-bottom-sheet.tsx"
      via: "conditional render"
      pattern: "isMobileLayout.*MobileBottomSheet"
---

<objective>
Implement mobile-responsive editor layout with bottom sheet navigation and FAB button.

Purpose: Artists edit on their phones constantly - this is the crucial mobile editing experience.
Output: Editor works flawlessly on mobile with bottom sheet pattern (like Google Maps).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04.5-editor-polish-mobile/04.5-CONTEXT.md
@.planning/phases/04.5-editor-polish-mobile/04.5-RESEARCH.md
@.planning/phases/04.5-editor-polish-mobile/04.5-01-SUMMARY.md
@src/components/editor/editor-layout.tsx
@src/components/editor/editor-panel.tsx
@src/components/ui/drawer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MobileBottomSheet wrapper component</name>
  <files>
    src/components/editor/mobile-bottom-sheet.tsx
  </files>
  <action>
    Create `src/components/editor/mobile-bottom-sheet.tsx`:

    This component wraps the editor content in a Vaul Drawer (bottom sheet) for mobile:

    1. Import shadcn Drawer components (Drawer, DrawerContent, DrawerTrigger, DrawerClose, DrawerHeader, DrawerTitle)
    2. Accept props:
       - `open: boolean` - controlled open state
       - `onOpenChange: (open: boolean) => void`
       - `children: ReactNode` - content to show in sheet
       - `title?: string` - optional title for sheet header

    3. Implement the Drawer with:
       - `direction="bottom"` - slides from bottom
       - Height: `h-[85vh]` to leave preview visible at top (dimmed)
       - Scrollable content area with `overflow-y-auto`
       - Close button in header
       - Swipe-down to dismiss built into Vaul

    4. Style considerations:
       - Background: bg-background
       - Handle indicator at top (Vaul provides this)
       - Ensure `modal={true}` for iOS Safari background tap dismiss
       - Add touch-pan-y to scrollable content to allow scroll without conflicts

    Reference the existing Sheet component styling for consistency.
  </action>
  <verify>
    - File exists: `src/components/editor/mobile-bottom-sheet.tsx`
    - Exports MobileBottomSheet component
    - TypeScript compiles: `pnpm tsc --noEmit`
  </verify>
  <done>
    MobileBottomSheet component wraps editor content in dismissible bottom sheet.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create FAB button and update EditorLayout for mobile</name>
  <files>
    src/components/editor/mobile-fab.tsx
    src/components/editor/editor-layout.tsx
  </files>
  <action>
    1. Create `src/components/editor/mobile-fab.tsx`:
       - Floating action button fixed at bottom-right (bottom-6 right-6)
       - z-50 to float above content
       - Use existing Button component with size="icon" and round styling
       - Plus icon from lucide-react
       - Only visible on mobile (`md:hidden` class)
       - h-14 w-14 for 56px touch target (above 48px minimum)
       - Shadow for elevation: shadow-lg
       - Accept `onClick` prop to trigger add card action
       - aria-label="Add card" for accessibility

    2. Update `src/components/editor/editor-layout.tsx`:
       - Import `useIsMobileLayout` from `@/hooks/use-media-query`
       - Import MobileBottomSheet
       - Import MobileFAB

       - Add state for mobile sheet:
         - `const [mobileSheetOpen, setMobileSheetOpen] = useState(false)`
         - `const [mobileSheetContent, setMobileSheetContent] = useState<'tabs' | 'card-editor'>('tabs')`

       - Conditional rendering based on `useIsMobileLayout()`:
         - **Desktop (not mobile):** Keep existing react-resizable-panels layout
         - **Mobile:** Render:
           a. Full-width PreviewPanel (no resizable panels)
           b. Floating MobileFAB in corner
           c. MobileBottomSheet with EditorPanel content
           d. Tap-to-edit logic (covered in integration below)

       - For mobile, the preview fills the screen, and tapping anywhere opens the bottom sheet with the editor tabs.

       - Add a way to open the sheet:
         - FAB click: opens sheet with cards tab focused
         - A "tab bar" at bottom showing Cards/Design/Insights (like mobile app nav)
         - Tapping any tab opens the sheet to that tab

    3. Mobile tab bar (alternative to FAB only):
       - Create a small fixed bottom bar with 3 icons (Cards, Design, Insights)
       - Tapping opens sheet to that specific tab
       - This bar sits above the bottom sheet when closed
       - Use existing tab icons if available, or use appropriate lucide icons
  </action>
  <verify>
    - `src/components/editor/mobile-fab.tsx` exists and exports MobileFAB
    - `src/components/editor/editor-layout.tsx` imports and uses useIsMobileLayout
    - On mobile breakpoint, layout switches to full-screen preview + bottom sheet
    - TypeScript compiles: `pnpm tsc --noEmit`
  </verify>
  <done>
    Editor layout adapts to mobile with full-screen preview and bottom sheet navigation.
  </done>
</task>

<task type="auto">
  <name>Task 3: Wire card selection to bottom sheet and add touch targets</name>
  <files>
    src/components/editor/editor-panel.tsx
    src/components/editor/cards-tab.tsx
  </files>
  <action>
    1. Update editor-panel.tsx for mobile context:
       - Accept optional prop `onCardSelect?: () => void` that mobile layout calls when card property editor should open
       - When a card is selected (selectedCardId changes), call onCardSelect if provided
       - This allows mobile layout to detect card selection and open the bottom sheet to property editor

    2. Update cards-tab.tsx touch targets:
       - Ensure all clickable elements have minimum h-11 (44px) height for touch
       - Add card buttons should be at least h-12 for clear tap targets
       - Card list items should have adequate padding for touch (p-3 minimum)

    3. Integration in editor-layout.tsx (mobile mode):
       - When selectedCardId changes (from page-store), open bottom sheet to card editor view
       - This means tapping a card in the preview iframe triggers the sheet to open
       - The existing postMessage system handles card selection from preview

    4. Mobile-specific considerations:
       - Add `touch-action: pan-y` to scrollable areas to prevent conflicts
       - Ensure drag handles have `touch-action: none` (existing pattern from dnd-kit work)
  </action>
  <verify>
    - On mobile, tapping a card in preview opens bottom sheet with card editor
    - Touch targets are at least 44px
    - TypeScript compiles: `pnpm tsc --noEmit`
    - Run `pnpm dev` and test in browser DevTools mobile emulator
  </verify>
  <done>
    Card selection triggers bottom sheet; touch targets sized appropriately.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Run `pnpm tsc --noEmit` - no type errors
2. Run `pnpm lint` - no lint errors
3. Run `pnpm dev` and test:
   - Desktop: Existing split-panel layout works
   - Mobile (DevTools or real device): Full-screen preview with bottom sheet
   - Tap bottom nav to open sheet
   - Tap card in preview to open property editor
   - FAB visible on mobile, hidden on desktop
4. Test tablet orientation:
   - Landscape: Desktop layout
   - Portrait: Mobile layout
</verification>

<success_criteria>
- Mobile layout shows full-screen preview with bottom sheet navigation
- Desktop layout unchanged (split panels)
- FAB button visible on mobile only
- Bottom sheet opens/closes with swipe and tap
- Card selection opens property editor in sheet
- Touch targets meet 44px minimum
</success_criteria>

<output>
After completion, create `.planning/phases/04.5-editor-polish-mobile/04.5-02-SUMMARY.md`
</output>
