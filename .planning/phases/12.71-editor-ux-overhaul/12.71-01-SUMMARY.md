---
phase: 12.71-editor-ux-overhaul
plan: 01
subsystem: ui
tags: [react, contenteditable, postmessage, iframe, zustand, direct-manipulation]

# Dependency graph
requires:
  - phase: 12.6-security-hardening
    provides: Secure postMessage origin validation already in place
provides:
  - InlineEditable reusable contentEditable component (ref-based, blur-commit, Escape-cancel)
  - Click-to-navigate for profile header elements (header tab)
  - Click-to-navigate for background area (style tab)
  - postMessage handlers for UPDATE_PROFILE, UPDATE_CARD, DELETE_CARD, DUPLICATE_CARD, INLINE_EDIT_ACTIVE, INLINE_EDIT_DONE
  - Deselect suppression during inline edit sessions
affects:
  - 12.71-05 (inline profile editing uses InlineEditable + UPDATE_PROFILE)
  - 12.71-06 (inline card text editing uses InlineEditable + UPDATE_CARD)
  - 12.71-07 (floating toolbar uses DELETE_CARD + DUPLICATE_CARD)

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "contentEditable ref-based uncontrolled pattern: sync prop→DOM only when !focused, commit on blur"
    - "Click-to-navigate via postMessage OPEN_DESIGN_TAB with tab payload"
    - "Inline edit gate: isInlineEditActiveRef suppresses deselect during editing"

key-files:
  created:
    - src/components/preview/inline-editable.tsx
  modified:
    - src/components/preview/profile-header.tsx
    - src/app/preview/page.tsx
    - src/components/editor/preview-panel.tsx

key-decisions:
  - "Used useCallback for all click/focus/blur handlers in InlineEditable to avoid unnecessary re-renders"
  - "Used isInlineEditActiveRef (not state) for inline edit gate — ref avoids stale closures in handleDeselect"
  - "Profile update handler in preview-panel uses field-specific store setters (setDisplayName/setBio) rather than a generic updateProfile call"
  - "Background click handler uses e.target === e.currentTarget guard so cards/content don't trigger style tab navigation"
  - "Hover affordances (cursor-pointer, ring) gated on useIsInEditorIframe() — public pages show no editing indicators"

patterns-established:
  - "Pattern 1: InlineEditable — uncontrolled contentEditable with ref, sync prop only when unfocused"
  - "Pattern 2: postMessage OPEN_DESIGN_TAB { tab } — shared navigation primitive for all click-to-navigate features"
  - "Pattern 3: isInlineEditActiveRef + INLINE_EDIT_ACTIVE/DONE messages — gating parent deselect during child edits"

# Metrics
duration: 4min
completed: 2026-02-26
---

# Phase 12.71 Plan 01: Click-to-Navigate Infrastructure Summary

**Click-to-navigate foundation with InlineEditable component, header/background click handlers, and 6 new postMessage types wired in preview-panel for Plans 05-07**

## Performance

- **Duration:** 4 min
- **Started:** 2026-02-26T05:22:02Z
- **Completed:** 2026-02-26T05:25:23Z
- **Tasks:** 2
- **Files modified:** 4 (1 created)

## Accomplishments
- Created `InlineEditable` reusable contentEditable component — the shared building block for Plans 05 and 06 inline editing
- Added click handlers to profile header (avatar, title, bio) posting `OPEN_DESIGN_TAB { tab: header }` — navigates editor to Header tab
- Background click in preview posts `OPEN_DESIGN_TAB { tab: style }` with `e.target === e.currentTarget` guard
- Wired 6 new postMessage types in preview-panel: UPDATE_PROFILE, UPDATE_CARD, DELETE_CARD, DUPLICATE_CARD, INLINE_EDIT_ACTIVE, INLINE_EDIT_DONE
- Added `isInlineEditActiveRef` to suppress `handleDeselect` during inline editing sessions

## Task Commits

Each task was committed atomically:

1. **Task 1: Create InlineEditable and click-to-navigate handlers** - `8f1caed` (feat)
2. **Task 2: Wire postMessage handlers in parent** - `d9153b0` (feat)

**Plan metadata:** (docs commit below)

## Files Created/Modified
- `src/components/preview/inline-editable.tsx` - Reusable contentEditable wrapper; uncontrolled ref pattern, blur-commit, Escape-cancel, Enter-blur (single-line)
- `src/components/preview/profile-header.tsx` - Click handlers on avatar/title/bio; hover affordances (ring + cursor-pointer) only in editor iframe context
- `src/app/preview/page.tsx` - Background click posts OPEN_DESIGN_TAB style; guarded with e.target === e.currentTarget
- `src/components/editor/preview-panel.tsx` - 6 new message cases + isInlineEditActiveRef + handleDeselect guard

## Decisions Made
- Used `isInlineEditActiveRef` (not useState) for the inline edit gate — ref avoids stale closures in the `handleDeselect` async callback
- Profile store updates use field-specific setters (`setDisplayName`/`setBio`) for type safety, not a generic field-patch approach
- `useIsInEditorIframe()` helper function (not a hook) checks `window.parent !== window` at render time — used for conditional hover affordance classes
- `postOpenHeaderTab()` extracted as standalone function (not inline) for reuse across both classic and hero layout variants

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered
None

## Next Phase Readiness
- `InlineEditable` component ready for Plans 05 (profile inline editing) and 06 (card text inline editing)
- `UPDATE_PROFILE`, `UPDATE_CARD`, `DELETE_CARD`, `DUPLICATE_CARD` handlers ready for Plans 05, 06, 07
- Click-to-navigate working for header and background areas
- No blockers for subsequent plans

---
*Phase: 12.71-editor-ux-overhaul*
*Completed: 2026-02-26*
