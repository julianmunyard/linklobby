---
phase: 12.71-editor-ux-overhaul
plan: 05
type: execute
wave: 2
depends_on: ["12.71-01"]
files_modified:
  - src/components/preview/profile-header.tsx
  - src/app/preview/page.tsx
autonomous: true

must_haves:
  truths:
    - "Clicking title text in preview makes it editable in-place"
    - "Clicking bio text in preview makes it editable in-place"
    - "Edited text commits to profile store on blur"
    - "Edited text persists across page refresh"
    - "Escape key cancels the edit and restores original text"
  artifacts:
    - path: "src/components/preview/profile-header.tsx"
      provides: "Inline editing for title and bio using InlineEditable"
      contains: "InlineEditable"
  key_links:
    - from: "src/components/preview/profile-header.tsx"
      to: "src/components/editor/preview-panel.tsx"
      via: "postMessage UPDATE_PROFILE"
      pattern: "UPDATE_PROFILE"
    - from: "src/components/preview/profile-header.tsx"
      to: "src/components/editor/preview-panel.tsx"
      via: "postMessage INLINE_EDIT_ACTIVE/DONE"
      pattern: "INLINE_EDIT_ACTIVE"
---

<objective>
Implement inline title and bio editing in the preview iframe.

Purpose: Artists should click the title or bio in their preview and type directly there — no hunting through tabs. This is the core "Canva-style" direct manipulation experience.

Output: Title and bio are editable in-place in the preview, with changes syncing to the profile store.
</objective>

<execution_context>
@/Users/julianmunyard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/julianmunyard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/12.71-editor-ux-overhaul/12.71-RESEARCH.md
@.planning/phases/12.71-editor-ux-overhaul/12.71-01-SUMMARY.md

Key files to reference:
@src/components/preview/inline-editable.tsx (created in Plan 01)
@src/components/preview/profile-header.tsx (header rendering in preview)
@src/components/editor/preview-panel.tsx (postMessage handler — UPDATE_PROFILE already wired in Plan 01)
@src/stores/profile-store.ts (profile state)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire InlineEditable into profile header for title and bio</name>
  <files>
    src/components/preview/profile-header.tsx
  </files>
  <action>
1. In `src/components/preview/profile-header.tsx`:
   - Import `InlineEditable` from `@/components/preview/inline-editable`
   - Find where the display name / title is rendered (likely a `<h1>` or `<p>` with profile.displayName)
   - Replace the static text with `<InlineEditable>` wrapper:
     ```
     <InlineEditable
       value={profile.displayName || ''}
       onCommit={(text) => handleInlineCommit('displayName', text)}
       multiline={false}
       className={/* keep existing heading classes */}
       placeholder="Your Name"
     />
     ```
   - Find where the bio is rendered (profile.bio or similar)
   - Replace with InlineEditable using `multiline={true}`:
     ```
     <InlineEditable
       value={profile.bio || ''}
       onCommit={(text) => handleInlineCommit('bio', text)}
       multiline={true}
       className={/* keep existing bio classes */}
       placeholder="Add a bio..."
     />
     ```

2. Create a `handleInlineCommit` function:
   ```typescript
   const handleInlineCommit = (field: string, value: string) => {
     if (window.parent !== window) {
       window.parent.postMessage(
         { type: 'UPDATE_PROFILE', payload: { field, value } },
         window.location.origin
       )
     }
   }
   ```

3. Send INLINE_EDIT_ACTIVE/DONE messages to suppress deselect:
   - On the InlineEditable's underlying element, add onFocus/onBlur handlers (may need to extend InlineEditable with `onFocusChange` callback or add wrapper handlers):
     ```
     onFocus: postMessage({ type: 'INLINE_EDIT_ACTIVE' })
     onBlur: postMessage({ type: 'INLINE_EDIT_DONE' })
     ```
   - If InlineEditable doesn't expose focus/blur events, either:
     a. Add `onEditStart` and `onEditEnd` props to InlineEditable, or
     b. Wrap InlineEditable in a div with onFocusCapture/onBlurCapture handlers

4. IMPORTANT: Only show InlineEditable when inside the editor iframe (`window.parent !== window`). On the public page, render the original static text. Use a state check or a prop like `isEditable` to toggle.

5. Keep the existing click-to-navigate handler from Plan 01 as a FALLBACK — if the user clicks the avatar area (not title/bio), it should still navigate to the Header tab. The InlineEditable handles its own click (to start editing), so the OPEN_DESIGN_TAB handler should NOT fire when clicking on InlineEditable elements. Use `e.stopPropagation()` on the InlineEditable container to prevent the parent click handler from firing.

6. Style the InlineEditable to match the existing text exactly — same font family, size, color, alignment. The `className` prop should carry all existing Tailwind classes. Add a subtle visual indicator on hover/focus (e.g., `focus:outline-none focus:ring-1 focus:ring-blue-400/50 rounded-sm`) to show it's editable.
  </action>
  <verify>
    - `npm run build` passes
    - In editor: click title text in preview -> text becomes editable, cursor appears
    - Type new text, click away -> title updates in editor panel's header section
    - In editor: click bio text -> bio becomes editable with multiline support
    - Press Escape during edit -> original text restored
    - Public page: title and bio render as static text (not editable)
  </verify>
  <done>
    - Title is inline-editable in preview with single-line mode
    - Bio is inline-editable in preview with multiline mode
    - Changes commit to profile store via UPDATE_PROFILE postMessage
    - Deselect suppressed during inline editing
    - Public page shows static text (not editable)
    - Visual editing indicators present on hover/focus
  </done>
</task>

</tasks>

<verification>
- `npm run build` completes with 0 TypeScript errors
- Inline title editing works: click, type, blur -> saves
- Inline bio editing works with multiline support
- Escape cancels edit
- Public page is not affected (no contentEditable on public)
- No cursor reset issues (uncontrolled contentEditable pattern)
</verification>

<success_criteria>
- Title and bio inline editing works end-to-end in editor preview
- Changes sync to profile store and persist on save
- No editing artifacts on public page
- Build passes clean
</success_criteria>

<output>
After completion, create `.planning/phases/12.71-editor-ux-overhaul/12.71-05-SUMMARY.md`
</output>
