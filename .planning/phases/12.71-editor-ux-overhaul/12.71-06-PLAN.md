---
phase: 12.71-editor-ux-overhaul
plan: 06
type: execute
wave: 2
depends_on: ["12.71-01"]
files_modified:
  - src/components/cards/text-card.tsx
  - src/app/preview/page.tsx
autonomous: true

must_haves:
  truths:
    - "Clicking text card title in preview makes it editable in-place"
    - "Edited text card title commits to page store on blur"
    - "Text card inline editing only works in editor iframe, not on public page"
  artifacts:
    - path: "src/components/cards/text-card.tsx"
      provides: "Text card with inline editing capability"
      contains: "InlineEditable"
  key_links:
    - from: "src/components/cards/text-card.tsx"
      to: "src/components/editor/preview-panel.tsx"
      via: "postMessage UPDATE_CARD"
      pattern: "UPDATE_CARD"
---

<objective>
Implement inline text card editing in the preview iframe.

Purpose: Artists should click a text card in their preview and type directly there. Text cards are the simplest inline editing target — single text field, already selected in preview.

Output: Text card titles are editable in-place in the preview.
</objective>

<execution_context>
@/Users/julianmunyard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/julianmunyard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/12.71-editor-ux-overhaul/12.71-RESEARCH.md
@.planning/phases/12.71-editor-ux-overhaul/12.71-01-SUMMARY.md

Key files to reference:
@src/components/preview/inline-editable.tsx (created in Plan 01)
@src/components/cards/text-card.tsx (text card rendering)
@src/components/editor/preview-panel.tsx (UPDATE_CARD handler wired in Plan 01)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add inline editing to text card</name>
  <files>
    src/components/cards/text-card.tsx
    src/app/preview/page.tsx
  </files>
  <action>
1. In `src/components/cards/text-card.tsx`:
   - Add an `isEditable` prop (default false): `isEditable?: boolean`
   - Import `InlineEditable` from `@/components/preview/inline-editable`
   - When `isEditable` is true and the card is selected, replace the static title rendering with:
     ```
     <InlineEditable
       value={card.title || ''}
       onCommit={(text) => handleTitleCommit(text)}
       multiline={true}
       className={/* keep existing title classes */}
       placeholder="Type something..."
     />
     ```
   - When `isEditable` is false (public page), render the existing static text with `renderWithLineBreaks` (from Plan 03)
   - Create `handleTitleCommit`:
     ```typescript
     const handleTitleCommit = (text: string) => {
       if (window.parent !== window) {
         window.parent.postMessage(
           { type: 'UPDATE_CARD', payload: { cardId: card.id, title: text } },
           window.location.origin
         )
       }
     }
     ```

2. Send INLINE_EDIT_ACTIVE/DONE on focus/blur of the InlineEditable:
   - On focus: `window.parent.postMessage({ type: 'INLINE_EDIT_ACTIVE' }, window.location.origin)`
   - On blur: `window.parent.postMessage({ type: 'INLINE_EDIT_DONE' }, window.location.origin)`

3. In `src/app/preview/page.tsx` (or wherever TextCard is rendered in the preview):
   - Pass `isEditable={true}` to TextCard when rendered inside the editor iframe
   - The preview page already knows it's inside an iframe — look for the existing `window.parent !== window` pattern or an `isEmbedded` flag
   - If TextCard is rendered via CardRenderer, add the `isEditable` prop passthrough in the card renderer's TextCard case

4. IMPORTANT: Do NOT modify the public page rendering. The public page components (StaticFlowGrid etc.) should continue passing `isEditable={false}` (default) or not passing the prop at all.

5. Use `e.stopPropagation()` on the InlineEditable wrapper to prevent the card click (SELECT_CARD) from firing when the user clicks to start editing.
  </action>
  <verify>
    - `npm run build` passes
    - In editor: click text card in preview -> text becomes editable with cursor
    - Type new text, click away -> text card title updates in editor panel
    - Multiline: press Enter while editing -> creates line break
    - Escape cancels edit
    - Public page: text card renders static text (not editable)
  </verify>
  <done>
    - Text card title is inline-editable in editor preview
    - Changes commit to page store via UPDATE_CARD postMessage
    - Multiline editing with Enter support
    - Public page unaffected
    - INLINE_EDIT_ACTIVE/DONE messages sent correctly
  </done>
</task>

</tasks>

<verification>
- `npm run build` completes with 0 TypeScript errors
- Text card inline editing works: click, type, blur -> saves
- Multiline support works with Enter key
- Public page shows static text
- No conflict with SELECT_CARD click handler
</verification>

<success_criteria>
- Text card inline editing works end-to-end in editor preview
- Changes sync to page store and persist on save
- No editing on public page
- Build passes clean
</success_criteria>

<output>
After completion, create `.planning/phases/12.71-editor-ux-overhaul/12.71-06-SUMMARY.md`
</output>
