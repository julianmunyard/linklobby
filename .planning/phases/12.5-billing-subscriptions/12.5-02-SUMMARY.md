---
phase: 12.5-billing-subscriptions
plan: 02
subsystem: ui
tags: [stripe, billing, pricing, react, nextjs, tailwind]

# Dependency graph
requires:
  - phase: 12.5-01
    provides: Stripe client, checkout/portal API routes, getUserPlan(), PLANS config, PlanTier type

provides:
  - Public /pricing page with 3-tier comparison (Free/Pro/Artist) and monthly/annual toggle
  - PricingTable component with checkout flow and 401→login redirect
  - PlanBadge pill component linking to /pricing with tier-specific colors
  - UpgradeModal dialog for contextual upgrade prompts
  - BillingSection in settings showing plan info, trial notice, renewal date, portal button
  - PlanBadge in AppSidebar footer and DashboardHeader next to username
  - Dashboard layout fetches planTier server-side and passes to sidebar

affects:
  - 12.5-03 (feature gating — PlanBadge and UpgradeModal ready for use)
  - 12.6-security-hardening (settings page now has billing section)

# Tech tracking
tech-stack:
  added: []
  patterns:
    - Server component fetches planTier from DB, passes to client components as prop
    - PricingTable sends tier+period to checkout API (server resolves price ID from env vars)
    - Free users see Upgrade Plan link; paid users see Manage Billing button

key-files:
  created:
    - src/app/pricing/page.tsx
    - src/app/pricing/layout.tsx
    - src/components/billing/pricing-table.tsx
    - src/components/billing/plan-badge.tsx
    - src/components/billing/upgrade-modal.tsx
    - src/components/billing/billing-section.tsx
  modified:
    - src/app/(dashboard)/settings/page.tsx
    - src/components/dashboard/app-sidebar.tsx
    - src/components/dashboard/dashboard-header.tsx
    - src/app/(dashboard)/layout.tsx
    - src/app/(dashboard)/editor/page.tsx
    - src/components/editor/editor-client-wrapper.tsx
    - src/app/api/billing/checkout/route.ts

key-decisions:
  - "PricingTable sends {tier, period} to checkout API instead of priceId — keeps Stripe price IDs server-side only"
  - "Checkout API updated to accept tier+period as alternative to priceId, resolving price ID from PLANS config server-side"
  - "PlanBadge is a server-safe component (no 'use client') — renders as Link, receives tier as prop"
  - "DashboardHeader gets planTier from editor page (server component) not layout — layout header is minimal"
  - "Free users in settings see Upgrade Plan link only — no Manage Billing (they have no Stripe customer record)"

patterns-established:
  - "PlanBadge: tier-colored pill (free=muted, pro=amber, artist=purple) linking to /pricing"
  - "UpgradeModal: wraps PricingTable in Dialog with optional feature name context"
  - "BillingSection: server-fetched subscription data passed as props to client component"

# Metrics
duration: 5min
completed: 2026-02-25
---

# Phase 12.5 Plan 02: Billing UI Summary

**Public /pricing page with 3-tier comparison and monthly/annual toggle, PlanBadge in sidebar and editor header, BillingSection in settings with Customer Portal access, and UpgradeModal for contextual upgrade prompts.**

## Performance

- **Duration:** ~5 min
- **Started:** 2026-02-25T02:36:30Z
- **Completed:** 2026-02-25T02:41:01Z
- **Tasks:** 2/2
- **Files modified:** 13

## Accomplishments

- Public /pricing page accessible without auth, shows 3-tier comparison (Free/Pro/Artist) with monthly/annual toggle and FAQ section
- PlanBadge tier-colored pill appears in sidebar footer and editor header, links to /pricing
- Settings page billing section shows current plan, trial/renewal info, and Manage Billing button (paid) or Upgrade Plan link (free)
- UpgradeModal wraps PricingTable in a Dialog for contextual "unlock feature" prompts
- Checkout API extended to accept tier+period (price ID resolved server-side from env vars)

## Task Commits

1. **Task 1: PricingTable, PlanBadge, UpgradeModal components** - `151f20f` (feat)
2. **Task 2: Public pricing page, billing settings, sidebar and header badge integration** - `0070d1b` (feat)

## Files Created/Modified

- `src/app/pricing/page.tsx` - Public pricing page, auth-optional, shows current tier for logged-in users
- `src/app/pricing/layout.tsx` - Minimal public layout with nav links and footer
- `src/components/billing/pricing-table.tsx` - 3-tier comparison with monthly/annual toggle and Stripe Checkout integration
- `src/components/billing/plan-badge.tsx` - Tier-colored pill Link component
- `src/components/billing/upgrade-modal.tsx` - Dialog wrapping PricingTable for contextual upgrade prompts
- `src/components/billing/billing-section.tsx` - Client component: plan info, trial notice, renewal date, portal button
- `src/app/(dashboard)/settings/page.tsx` - Added BillingSection below UsernameForm
- `src/components/dashboard/app-sidebar.tsx` - Added PlanBadge prop and footer rendering
- `src/components/dashboard/dashboard-header.tsx` - Added PlanBadge beside username
- `src/app/(dashboard)/layout.tsx` - Fetches planTier server-side, passes to AppSidebar
- `src/app/(dashboard)/editor/page.tsx` - Fetches planTier, passes to EditorClientWrapper
- `src/components/editor/editor-client-wrapper.tsx` - Accepts and passes planTier to DashboardHeader
- `src/app/api/billing/checkout/route.ts` - Accepts tier+period alternative to priceId

## Decisions Made

- **Checkout API accepts tier+period**: PricingTable client component can't access server env vars for Stripe price IDs, so the API now resolves them server-side from the PLANS config. Backward compatible — `priceId` still works.
- **PlanBadge is not 'use client'**: It's a simple Link component, no client state needed. Server and client components can both render it.
- **DashboardHeader planTier from editor page, not layout**: The layout's header is minimal (just SidebarTrigger). DashboardHeader is rendered by EditorClientWrapper. So planTier flows: editor/page.tsx → EditorClientWrapper → DashboardHeader.
- **Free users: no Manage Billing**: Free users have no Stripe customer record, so showing a portal button would error. Instead they see a link to /pricing.

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## User Setup Required

None - no external service configuration required beyond what Plan 01 already established.

## Next Phase Readiness

- All billing UI components ready — PricingTable, PlanBadge, UpgradeModal, BillingSection
- Plan 03 (feature gating) can import UpgradeModal directly for gate trigger points
- Requires Stripe env vars and DB migration (from Plan 01) for end-to-end checkout flow

---
*Phase: 12.5-billing-subscriptions*
*Completed: 2026-02-25*
