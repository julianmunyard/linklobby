---
phase: 12.5-billing-subscriptions
plan: 03
subsystem: payments
tags: [stripe, react, feature-gating, billing, nextjs, typescript]

# Dependency graph
requires:
  - phase: 12.5-01
    provides: PlanTier type, getUserPlan(), isPro(), isArtist(), PLANS config
  - phase: 12.5-02
    provides: UpgradeModal component, PlanBadge component

provides:
  - ProGate component (soft-lock badge overlay, fully interactive)
  - ProBadge component (standalone badge for lists/dropdowns)
  - PlanTierContext (planTier + openUpgradeModal state at dashboard shell level)
  - PlanTierProvider (wraps dashboard layout, renders UpgradeModal singleton)
  - Public page plan-gating (card filtering, branding, theme fallback)
  - PRO_THEMES list (designer themes gated behind Pro)

affects:
  - 12.5-04: settings billing tab may need to read planTier context
  - 12.6-security-hardening: public page gating pattern established
  - 12.2-theme-templates: Pro theme gating affects template availability

# Tech tracking
tech-stack:
  added: []
  patterns:
    - PlanTierContext pattern: context at shell level with modal singleton, avoids prop-drilling
    - Soft-lock ProGate: children always interactive, badge overlay triggers upgrade modal
    - Server-side plan gating: getUserPlan called once per public page render
    - hasProAccess threading: boolean prop threaded through renderer to all layout components

key-files:
  created:
    - src/components/billing/pro-gate.tsx
    - src/contexts/plan-tier-context.tsx
  modified:
    - src/lib/stripe/plans.ts
    - src/app/(dashboard)/layout.tsx
    - src/components/editor/card-property-editor.tsx
    - src/components/editor/cards-tab.tsx
    - src/components/editor/schedule-tab.tsx
    - src/components/editor/theme-presets.tsx
    - src/app/[username]/page.tsx
    - src/components/public/public-page-renderer.tsx
    - src/components/public/static-receipt-layout.tsx
    - src/components/public/static-vcr-menu-layout.tsx
    - src/components/public/static-macintosh-layout.tsx
    - src/components/public/static-artifact-layout.tsx
    - src/components/public/static-ipod-classic-layout.tsx
    - src/components/public/static-chaotic-zine-layout.tsx
    - src/components/public/static-word-art-layout.tsx

key-decisions:
  - "Soft-lock pattern: ProGate never blocks interaction — free users see Pro badge but can still touch the UI, creating desire not frustration"
  - "PlanTierProvider owns UpgradeModal as singleton at shell level — prevents Z-index fights, single modal source of truth"
  - "PRO_THEMES array in plans.ts contains all 8 designer themes (vcr-menu, ipod-classic, receipt, macintosh, word-art, phone-home, chaotic-zine, artifact)"
  - "Public page theme fallback to instagram-reels (not mac-os) for free users — instagram-reels is the most polished free theme"
  - "Schedule tab wrapped in ProGate at component level rather than per-card-item — cleaner UX, single upgrade prompt for entire scheduling feature"
  - "hasProAccess defaults to false in all layout components — safe default, Pro branding hidden unless explicitly granted"

patterns-established:
  - "ProGate pattern: position:relative wrapper + absolute badge top-right, z-10 — use for any Pro editor feature"
  - "ProBadge pattern: standalone amber badge component for use in dropdowns/lists where wrapper is impractical"
  - "Public page plan check: single getUserPlan() call per page render, then filter cards + gate theme before passing to renderer"

# Metrics
duration: 8min
completed: 2026-02-25
---

# Phase 12.5 Plan 03: Feature Gating Summary

**Soft-lock ProGate with amber badge overlays in editor, public page card/branding/theme stripping for free users via single getUserPlan() call at render time**

## Performance

- **Duration:** 8 min
- **Started:** 2026-02-25T02:44:24Z
- **Completed:** 2026-02-25T02:51:51Z
- **Tasks:** 2
- **Files modified:** 17

## Accomplishments

- Created ProGate (soft-lock wrapper) and ProBadge (standalone badge) components backed by PlanTierContext
- Wrapped all Pro editor features (email collection, release mode, link scheduling) in ProGate
- Added ProBadge next to Pro card types in cards-tab dropdown and Pro themes in theme-presets
- Public page strips email-collection and release cards plus schedule data for free users
- "Powered by LinkLobby" branding hidden for Pro/Artist across all 7 layout components that render it
- Pro-only designer themes fall back to instagram-reels on free public pages
- Dashboard layout now wraps children in PlanTierProvider (planTier + UpgradeModal singleton)

## Task Commits

1. **Task 1: ProGate component and editor integration** - `6f230d3` (feat)
2. **Task 2: Public page feature stripping and branding gating** - `36dfb86` (feat)

**Plan metadata:** (upcoming docs commit)

## Files Created/Modified

- `src/components/billing/pro-gate.tsx` - ProGate (soft-lock wrapper) and ProBadge (standalone badge) components
- `src/contexts/plan-tier-context.tsx` - PlanTierContext with planTier and openUpgradeModal; renders UpgradeModal singleton
- `src/lib/stripe/plans.ts` - Added PRO_THEMES string array (8 designer themes)
- `src/app/(dashboard)/layout.tsx` - Wrapped children in PlanTierProvider; planTier default changed from undefined to 'free'
- `src/components/editor/card-property-editor.tsx` - ProGate around email-collection fields, release fields, presave fields
- `src/components/editor/cards-tab.tsx` - ProBadge next to email-collection and release types in Add Card dropdown
- `src/components/editor/schedule-tab.tsx` - ProGate around entire schedule tab content
- `src/components/editor/theme-presets.tsx` - ProBadge next to each theme where PRO_THEMES.includes(theme.id)
- `src/app/[username]/page.tsx` - getUserPlan + card filtering + theme fallback + hasProAccess prop
- `src/components/public/public-page-renderer.tsx` - hasProAccess prop, LegalFooter now conditionally renders branding
- `src/components/public/static-receipt-layout.tsx` - hasProAccess prop, conditional "Powered by LinkLobby"
- `src/components/public/static-vcr-menu-layout.tsx` - hasProAccess prop, conditional "Powered by LinkLobby"
- `src/components/public/static-macintosh-layout.tsx` - hasProAccess prop, conditional "Powered by LinkLobby"
- `src/components/public/static-artifact-layout.tsx` - hasProAccess prop, conditional "Powered by LinkLobby"
- `src/components/public/static-ipod-classic-layout.tsx` - hasProAccess prop, conditional "Powered by LinkLobby"
- `src/components/public/static-chaotic-zine-layout.tsx` - hasProAccess prop, conditional "Powered by LinkLobby"
- `src/components/public/static-word-art-layout.tsx` - hasProAccess prop, conditional "Powered by LinkLobby"

## Decisions Made

- Soft-lock (not hard-lock): ProGate children stay interactive. Free users see what Pro features look like, creating desire. Clicking the badge opens UpgradeModal. Hard-locks would frustrate and confuse.
- PlanTierProvider at dashboard layout level: single UpgradeModal rendered once, no Z-index fights, context available to all editor client components without prop-drilling.
- PRO_THEMES includes all 8 designer themes. The "Custom Link Page" category (mac-os, instagram-reels, system-settings, blinkies) is free — these are the standard card-based themes.
- Theme fallback to 'instagram-reels': this is the most polished free card-based theme and the logical default for public pages.
- Schedule tab gated at component level: cleaner to wrap the entire tab in ProGate than per-row badges, since scheduling is uniformly Pro.

## Deviations from Plan

None - plan executed exactly as written. The plan specified wrapping Pro features in the editor and stripping them on the public page; both were executed precisely as specified.

## Issues Encountered

None.

## User Setup Required

None - no external service configuration required beyond what Plans 01 and 02 established.

## Next Phase Readiness

- Feature gating is now live end-to-end: editor shows Pro badges, public pages strip Pro features
- Plan 04 (settings billing tab) can read planTier from PlanTierContext via usePlanTier()
- Requires Stripe env vars and DB migration (from Plans 01-02) before end-to-end testing with real subscriptions

---
*Phase: 12.5-billing-subscriptions*
*Completed: 2026-02-25*
