---
phase: 04-basic-cards
plan: 03
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/components/editor/card-property-editor.tsx
  - src/components/editor/hero-card-fields.tsx
  - src/components/editor/horizontal-link-fields.tsx
  - src/components/editor/square-card-fields.tsx
autonomous: true

must_haves:
  truths:
    - "Selecting a card shows its properties in the editor"
    - "User can edit title, description, and URL for all card types"
    - "User can upload/remove image for all card types"
    - "Changes appear immediately in the store (optimistic updates)"
  artifacts:
    - path: "src/components/editor/card-property-editor.tsx"
      provides: "Main property editor that switches by card type"
      exports: ["CardPropertyEditor"]
      min_lines: 50
    - path: "src/components/editor/hero-card-fields.tsx"
      provides: "Hero-specific form fields (buttonText, buttonStyle)"
      exports: ["HeroCardFields"]
    - path: "src/components/editor/horizontal-link-fields.tsx"
      provides: "Horizontal-specific form fields"
      exports: ["HorizontalLinkFields"]
    - path: "src/components/editor/square-card-fields.tsx"
      provides: "Square-specific form fields (showTitle toggle)"
      exports: ["SquareCardFields"]
  key_links:
    - from: "src/components/editor/card-property-editor.tsx"
      to: "src/stores/page-store.ts"
      via: "updateCard action"
      pattern: "updateCard.*card\\.id"
    - from: "src/components/editor/card-property-editor.tsx"
      to: "src/components/cards/image-upload.tsx"
      via: "ImageUpload import"
      pattern: "import.*ImageUpload"
---

<objective>
Create the card property editor that displays when a card is selected, with form fields for editing card content.

Purpose: Artists need to configure cards - add titles, descriptions, URLs, and images. The property editor appears in the sidebar when a card is selected, showing appropriate fields for that card type.

Output:
- CardPropertyEditor component that shows when selectedCardId is set
- Type-specific field components for Hero, Horizontal, and Square cards
- Real-time updates to store as user types (optimistic updates pattern)
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/04-basic-cards/04-RESEARCH.md

# Dependencies from Plan 01
@src/types/card.ts
@src/components/cards/image-upload.tsx

# Existing infrastructure
@src/stores/page-store.ts
@src/components/ui/form.tsx
@src/components/ui/input.tsx
@src/components/ui/textarea.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CardPropertyEditor Main Component</name>
  <files>src/components/editor/card-property-editor.tsx</files>
  <action>
Create the main property editor component that shows common fields (title, description, URL, image) and switches additional fields based on card type.

Uses react-hook-form for form state management. Updates go directly to the Zustand store for optimistic updates.

```typescript
// src/components/editor/card-property-editor.tsx
"use client"

import { useEffect } from "react"
import { useForm } from "react-hook-form"
import { zodResolver } from "@hookform/resolvers/zod"
import { z } from "zod"
import { X } from "lucide-react"

import { Button } from "@/components/ui/button"
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from "@/components/ui/form"
import { Input } from "@/components/ui/input"
import { Textarea } from "@/components/ui/textarea"
import { ImageUpload } from "@/components/cards/image-upload"
import { HeroCardFields } from "./hero-card-fields"
import { HorizontalLinkFields } from "./horizontal-link-fields"
import { SquareCardFields } from "./square-card-fields"
import { usePageStore } from "@/stores/page-store"
import type { Card, HeroCardContent, HorizontalLinkContent, SquareCardContent } from "@/types/card"

// Common form schema
const cardFormSchema = z.object({
  title: z.string().max(100).optional(),
  description: z.string().max(500).optional(),
  url: z.string().url().optional().or(z.literal("")),
})

type CardFormValues = z.infer<typeof cardFormSchema>

interface CardPropertyEditorProps {
  card: Card
  onClose: () => void
}

export function CardPropertyEditor({ card, onClose }: CardPropertyEditorProps) {
  const updateCard = usePageStore((state) => state.updateCard)

  const form = useForm<CardFormValues>({
    resolver: zodResolver(cardFormSchema),
    defaultValues: {
      title: card.title ?? "",
      description: card.description ?? "",
      url: card.url ?? "",
    },
  })

  // Reset form when card changes
  useEffect(() => {
    form.reset({
      title: card.title ?? "",
      description: card.description ?? "",
      url: card.url ?? "",
    })
  }, [card.id, card.title, card.description, card.url, form])

  // Watch form changes and update store (optimistic updates)
  useEffect(() => {
    const subscription = form.watch((values) => {
      // Only update if values are valid-ish
      const title = values.title || null
      const description = values.description || null
      const url = values.url || null

      updateCard(card.id, {
        title,
        description,
        url,
      })
    })
    return () => subscription.unsubscribe()
  }, [form, card.id, updateCard])

  // Handle image changes
  function handleImageChange(imageUrl: string | undefined) {
    const content = { ...(card.content as Record<string, unknown>), imageUrl }
    updateCard(card.id, { content })
  }

  // Handle content field changes (for type-specific fields)
  function handleContentChange(updates: Record<string, unknown>) {
    const content = { ...(card.content as Record<string, unknown>), ...updates }
    updateCard(card.id, { content })
  }

  const currentContent = card.content as Record<string, unknown>
  const imageUrl = currentContent.imageUrl as string | undefined

  return (
    <div className="flex flex-col h-full">
      {/* Header */}
      <div className="flex items-center justify-between p-4 border-b">
        <div>
          <h2 className="font-semibold text-sm">Edit Card</h2>
          <p className="text-xs text-muted-foreground capitalize">
            {card.card_type.replace("_", " ")}
          </p>
        </div>
        <Button variant="ghost" size="icon" onClick={onClose}>
          <X className="h-4 w-4" />
          <span className="sr-only">Close</span>
        </Button>
      </div>

      {/* Form */}
      <div className="flex-1 overflow-y-auto p-4">
        <Form {...form}>
          <form className="space-y-6">
            {/* Image upload */}
            <div className="space-y-2">
              <label className="text-sm font-medium">Image</label>
              <ImageUpload
                value={imageUrl}
                onChange={handleImageChange}
                cardId={card.id}
                aspectRatio={card.card_type === "square" ? "square" : "video"}
              />
            </div>

            {/* Title */}
            <FormField
              control={form.control}
              name="title"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Title</FormLabel>
                  <FormControl>
                    <Input
                      placeholder="Enter title..."
                      {...field}
                      value={field.value ?? ""}
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />

            {/* Description */}
            <FormField
              control={form.control}
              name="description"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Description</FormLabel>
                  <FormControl>
                    <Textarea
                      placeholder="Enter description..."
                      rows={3}
                      {...field}
                      value={field.value ?? ""}
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />

            {/* URL */}
            <FormField
              control={form.control}
              name="url"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Link URL</FormLabel>
                  <FormControl>
                    <Input
                      type="url"
                      placeholder="https://..."
                      {...field}
                      value={field.value ?? ""}
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />

            {/* Type-specific fields */}
            {card.card_type === "hero" && (
              <HeroCardFields
                content={currentContent as HeroCardContent}
                onChange={handleContentChange}
              />
            )}
            {card.card_type === "horizontal" && (
              <HorizontalLinkFields
                content={currentContent as HorizontalLinkContent}
                onChange={handleContentChange}
              />
            )}
            {card.card_type === "square" && (
              <SquareCardFields
                content={currentContent as SquareCardContent}
                onChange={handleContentChange}
              />
            )}
          </form>
        </Form>
      </div>
    </div>
  )
}
```
  </action>
  <verify>`npx tsc --noEmit` - component compiles (will have missing import errors until other components created)</verify>
  <done>CardPropertyEditor renders form with common fields and type-specific field components</done>
</task>

<task type="auto">
  <name>Task 2: Create Type-Specific Field Components</name>
  <files>
src/components/editor/hero-card-fields.tsx
src/components/editor/horizontal-link-fields.tsx
src/components/editor/square-card-fields.tsx
  </files>
  <action>
Create the three type-specific field components.

**hero-card-fields.tsx:**
```typescript
// src/components/editor/hero-card-fields.tsx
"use client"

import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select"
import type { HeroCardContent } from "@/types/card"

// First, add Select component if not present
// Run: npx shadcn@latest add select

interface HeroCardFieldsProps {
  content: HeroCardContent
  onChange: (updates: Partial<HeroCardContent>) => void
}

export function HeroCardFields({ content, onChange }: HeroCardFieldsProps) {
  return (
    <div className="space-y-4 pt-4 border-t">
      <h3 className="text-sm font-medium">Hero Settings</h3>

      {/* Button text */}
      <div className="space-y-2">
        <Label htmlFor="buttonText">Button Text</Label>
        <Input
          id="buttonText"
          placeholder="Visit (default)"
          value={content.buttonText ?? ""}
          onChange={(e) => onChange({ buttonText: e.target.value || undefined })}
        />
        <p className="text-xs text-muted-foreground">
          Leave empty for stretched link (entire card clickable)
        </p>
      </div>

      {/* Button style */}
      <div className="space-y-2">
        <Label htmlFor="buttonStyle">Button Style</Label>
        <Select
          value={content.buttonStyle ?? "primary"}
          onValueChange={(value) =>
            onChange({ buttonStyle: value as HeroCardContent["buttonStyle"] })
          }
        >
          <SelectTrigger id="buttonStyle">
            <SelectValue />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="primary">Primary (White)</SelectItem>
            <SelectItem value="secondary">Secondary (Transparent)</SelectItem>
            <SelectItem value="outline">Outline</SelectItem>
          </SelectContent>
        </Select>
      </div>

      {/* Image alt text */}
      <div className="space-y-2">
        <Label htmlFor="imageAlt">Image Alt Text</Label>
        <Input
          id="imageAlt"
          placeholder="Describe the image..."
          value={content.imageAlt ?? ""}
          onChange={(e) => onChange({ imageAlt: e.target.value || undefined })}
        />
      </div>
    </div>
  )
}
```

**horizontal-link-fields.tsx:**
```typescript
// src/components/editor/horizontal-link-fields.tsx
"use client"

import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import type { HorizontalLinkContent } from "@/types/card"

interface HorizontalLinkFieldsProps {
  content: HorizontalLinkContent
  onChange: (updates: Partial<HorizontalLinkContent>) => void
}

export function HorizontalLinkFields({ content, onChange }: HorizontalLinkFieldsProps) {
  return (
    <div className="space-y-4 pt-4 border-t">
      <h3 className="text-sm font-medium">Link Settings</h3>

      {/* Image alt text */}
      <div className="space-y-2">
        <Label htmlFor="imageAlt">Thumbnail Alt Text</Label>
        <Input
          id="imageAlt"
          placeholder="Describe the thumbnail..."
          value={content.imageAlt ?? ""}
          onChange={(e) => onChange({ imageAlt: e.target.value || undefined })}
        />
      </div>

      {/* Note about icon - future feature */}
      <p className="text-xs text-muted-foreground">
        Icon selection coming soon. Upload a thumbnail image for now.
      </p>
    </div>
  )
}
```

**square-card-fields.tsx:**
```typescript
// src/components/editor/square-card-fields.tsx
"use client"

import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Switch } from "@/components/ui/switch"
import type { SquareCardContent } from "@/types/card"

// First, add Switch component if not present
// Run: npx shadcn@latest add switch

interface SquareCardFieldsProps {
  content: SquareCardContent
  onChange: (updates: Partial<SquareCardContent>) => void
}

export function SquareCardFields({ content, onChange }: SquareCardFieldsProps) {
  return (
    <div className="space-y-4 pt-4 border-t">
      <h3 className="text-sm font-medium">Tile Settings</h3>

      {/* Show title toggle */}
      <div className="flex items-center justify-between">
        <div className="space-y-0.5">
          <Label htmlFor="showTitle">Show Title Overlay</Label>
          <p className="text-xs text-muted-foreground">
            Display title on the image
          </p>
        </div>
        <Switch
          id="showTitle"
          checked={content.showTitle !== false}
          onCheckedChange={(checked) => onChange({ showTitle: checked })}
        />
      </div>

      {/* Image alt text */}
      <div className="space-y-2">
        <Label htmlFor="imageAlt">Image Alt Text</Label>
        <Input
          id="imageAlt"
          placeholder="Describe the image..."
          value={content.imageAlt ?? ""}
          onChange={(e) => onChange({ imageAlt: e.target.value || undefined })}
        />
      </div>
    </div>
  )
}
```

Before creating these files, install the required shadcn components:
```bash
npx shadcn@latest add select switch
```
  </action>
  <verify>
`npx tsc --noEmit` - all field components compile
src/components/ui/select.tsx and src/components/ui/switch.tsx exist
  </verify>
  <done>All three type-specific field components render their unique controls</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes - all components type-check
2. All four files exist:
   - src/components/editor/card-property-editor.tsx
   - src/components/editor/hero-card-fields.tsx
   - src/components/editor/horizontal-link-fields.tsx
   - src/components/editor/square-card-fields.tsx
3. shadcn components added: select, switch
4. CardPropertyEditor imports ImageUpload from cards/image-upload.tsx
5. Form changes update store via updateCard action
</verification>

<success_criteria>
- CardPropertyEditor shows common fields (title, description, URL, image)
- HeroCardFields shows buttonText, buttonStyle, imageAlt
- HorizontalLinkFields shows imageAlt
- SquareCardFields shows showTitle toggle, imageAlt
- Form changes immediately update the Zustand store
- Reset form values when different card is selected
</success_criteria>

<output>
After completion, create `.planning/phases/04-basic-cards/04-03-SUMMARY.md`
</output>
