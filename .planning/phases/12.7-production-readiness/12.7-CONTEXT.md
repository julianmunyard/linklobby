# Phase 12.7: Production Readiness & Operational Foundation - Context

**Gathered:** 2026-02-15
**Status:** Ready for planning

<domain>
## Phase Boundary

Everything operational, infrastructural, and polish-level that a production app needs beyond features and security. This covers: error tracking and monitoring, transactional email system, CI/CD pipeline, environment management (staging), custom error pages, structured logging, backup strategy documentation, .env.example, contact/support page, public status page considerations, JSON-LD structured data, performance hardening (caching headers, compression), and database operational concerns.

**Not in scope:** Security and auth (Phase 12.6), billing (Phase 12.5), feature work.

</domain>

<decisions>
## Implementation Decisions

### Error Tracking & Monitoring
- **Sentry** — integrate `@sentry/nextjs` for both client and server error tracking. Captures unhandled exceptions, promise rejections, and API errors.
- **Custom error pages:**
  - `error.tsx` — global error boundary with "Something went wrong" and retry button
  - `not-found.tsx` — improve existing 404 page with search suggestion or link to homepage
  - `global-error.tsx` — root layout error boundary as last resort
- **Error context** — attach user ID (anonymized), page slug, theme, and card count to Sentry events for debugging
- **Performance monitoring** — enable Sentry performance traces on key routes (public page load, editor save, audio upload)
- **Alerts** — configure Sentry alerts for error spike detection (email notification)

### Transactional Email System
- **Provider:** Resend (built for developers, great Next.js integration, generous free tier)
- **Emails to send:**
  - Welcome email (on signup, after email verification)
  - Password reset email (via Supabase custom SMTP pointing to Resend)
  - Email change confirmation
  - Account deletion scheduled notice (when user requests deletion)
  - Account deletion final warning (7 days before permanent deletion)
  - Account recovery confirmation (if user cancels deletion)
- **Email templates:** Simple, clean HTML emails with LinkLobby branding. Not over-designed.
- **Supabase custom SMTP:** Point Supabase's auth emails (confirmation, password reset) through Resend so they come from a branded address (e.g., hello@linklobby.com) instead of Supabase's default
- **Unsubscribe:** Transactional emails don't need unsubscribe (they're triggered by user actions), but marketing emails via fan email collection should have unsubscribe link (already handled by Mailchimp)

### CI/CD Pipeline
- **GitHub Actions** workflow:
  - On PR: TypeScript type-check (`tsc --noEmit`), ESLint, build verification (`next build`)
  - On merge to main: auto-deploy to Vercel (or trigger Vercel deploy hook)
  - Optional: Lighthouse CI for performance regression (public page < 2s)
- **Branch protection:** Require CI pass before merge to main
- **Preview deployments:** Vercel preview deploys on every PR for visual review

### Environment Management
- **`.env.example`** — document every required and optional environment variable with descriptions and example values (no real secrets)
- **Staging environment** — separate Vercel project pointing to a separate Supabase project. Same codebase, different data.
- **Environment variable documentation:**
  ```
  # Required
  NEXT_PUBLIC_SUPABASE_URL=
  NEXT_PUBLIC_SUPABASE_ANON_KEY=
  NEXT_PUBLIC_SITE_URL=

  # Auth (required for OAuth)
  GOOGLE_CLIENT_ID=
  GOOGLE_CLIENT_SECRET=

  # Email (required for transactional emails)
  RESEND_API_KEY=

  # Monitoring (required for production)
  SENTRY_DSN=
  NEXT_PUBLIC_SENTRY_DSN=
  SENTRY_AUTH_TOKEN=

  # Rate Limiting (required for production)
  UPSTASH_REDIS_REST_URL=
  UPSTASH_REDIS_REST_TOKEN=

  # Optional integrations
  MAILCHIMP_API_KEY=
  FACEBOOK_CAPI_TOKEN=
  ```

### Structured Logging
- **Server-side logging** — use a lightweight structured logger (pino) for API routes. Log request method, path, user ID, duration, status code.
- **Log levels:** error (always), warn (always), info (production), debug (development only)
- **No PII in logs** — never log emails, passwords, or full IP addresses
- **Vercel logs** — Vercel captures stdout/stderr automatically, structured JSON format makes them searchable

### Database Operations
- **Backup strategy documentation** — document that Supabase Pro plan includes daily backups with point-in-time recovery. Verify the current plan covers this.
- **Migration deployment** — document the process for running migrations against production Supabase
- **Connection pooling** — verify Supabase connection pooler is enabled for production workloads
- **Indexes audit** — verify indexes exist on all frequently-queried columns (user_id, page_id, username, created_at on analytics tables)

### Performance Hardening
- **Cache-Control headers:**
  - Static assets (images, fonts, JS/CSS): `public, max-age=31536000, immutable` (Next.js handles this)
  - Public pages: `public, s-maxage=60, stale-while-revalidate=300` (1min fresh, 5min stale OK)
  - API responses: `private, no-cache` (authenticated data)
  - Audio files: `public, max-age=86400` (24hr cache)
- **Compression:** Verify gzip/brotli is enabled (Vercel does this automatically, but verify)
- **Image optimization:** Verify next/image is being used everywhere, no raw `<img>` tags for user content
- **Bundle analysis** — run `@next/bundle-analyzer` once to identify any oversized dependencies
- **Lazy loading** — verify heavy components (games, audio engine, color picker) are dynamically imported

### SEO Enhancements
- **JSON-LD structured data** on public pages:
  - `Person` or `MusicGroup` schema with name, image, URL, social links
  - `WebPage` schema with description
- **Meta description** — generate from user's bio or first few card titles
- **Canonical URLs** — ensure each public page has a canonical URL tag

### Contact & Support
- **Contact page** (`/contact`) — simple page with:
  - Support email address
  - Link to FAQ/help (can be placeholder initially)
  - Bug report link (GitHub issues or email)
- **Footer links** — add contact, terms, privacy to a minimal site footer on public-facing pages (landing, login, signup)
- **In-app help** — small "?" icon in editor that links to support/FAQ

### Public Status & Trust
- **Status page consideration** — for launch, a simple "System Status" section on the contact page is fine. Full Statuspage.io integration is overkill for launch.
- **Uptime monitoring** — set up a free Uptime Robot or similar to ping the homepage and one public page every 5 minutes. Alert on downtime.

### Custom Error Recovery
- **Offline indicator** — detect when user loses connection in editor, show banner "You're offline — changes will save when reconnected"
- **Save retry** — if a save fails, queue it and retry when connection returns (already partially implemented in Phase 4.5)
- **Graceful degradation** — if Sentry is unreachable, don't break the app. If Resend is down, auth still works (just emails delayed).

### Claude's Discretion
- Sentry configuration details (sample rates, environments)
- Email template visual design
- CI/CD exact workflow steps and caching strategy
- Structured logging format details
- JSON-LD schema specifics
- Contact page design
- Bundle size thresholds for CI checks
- Cache-Control exact values can be tuned based on traffic patterns

</decisions>

<specifics>
## Specific Ideas

- Sentry should use environment tags: "production", "staging", "development" to separate noise
- Welcome email should include a link to their page (linklobby.com/username) and a "Start editing" CTA
- CI should cache node_modules and .next build cache for speed
- The .env.example should be the FIRST thing created in this phase so it's useful immediately
- Contact page should feel warm, not corporate — this is a creative tool for artists
- Uptime monitoring should check both the homepage AND a real public page (to catch data-layer issues)
- Bundle analysis results should inform if any dynamic imports are needed

</specifics>

<deferred>
## Deferred Ideas

- Full Statuspage.io or Betteruptime integration (overkill for launch)
- PagerDuty or OpsGenie alerting (just email alerts for now)
- Log aggregation service like DataDog or LogRocket (Vercel logs + Sentry is enough)
- A/B testing infrastructure
- Feature flags system (LaunchDarkly etc.)
- Automated database migration CI step (manual for now)
- Load testing / stress testing (not needed until significant traffic)
- CDN configuration beyond Vercel's built-in CDN
- Automated security scanning (Snyk, Dependabot — can add later)
- Internationalization / i18n (English only for launch)

</deferred>

---

*Phase: 12.7-production-readiness*
*Context gathered: 2026-02-15*
