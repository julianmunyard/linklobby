---
phase: "04.3-card-context-menu"
plan: "02"
subsystem: "editor"
tags: ["card-actions", "type-picker", "undo-redo", "duplicate", "delete"]

dependency_graph:
  requires:
    - "04.3-01 (undo/redo infrastructure)"
  provides:
    - "Card type switching UI"
    - "Duplicate card action"
    - "Delete with undo toast"
    - "Header undo/redo buttons"
  affects:
    - "04.4 (profile editor - may use similar action pattern)"
    - "04.5 (mobile polish - touch targets for buttons)"

tech_stack:
  added: []
  patterns:
    - "Visual tile picker for card types"
    - "Delete with toast undo (no confirmation dialog)"
    - "Header action buttons with disabled states"

key_files:
  created:
    - "src/components/editor/card-type-picker.tsx"
  modified:
    - "src/components/editor/card-property-editor.tsx"
    - "src/components/dashboard/dashboard-header.tsx"
    - "src/stores/page-store.ts"

decisions:
  - id: "convertible-types-only"
    choice: "Only hero/horizontal/square are convertible"
    why: "Dropdown is a container, video/gallery/game/audio have specialized content"
  - id: "delete-no-confirmation"
    choice: "Delete immediately with undo toast"
    why: "Modern pattern - faster workflow, undo provides safety net"
  - id: "duplicate-selects-new"
    choice: "Duplicate creates copy and selects it"
    why: "User likely wants to edit the new card immediately"

metrics:
  duration: "3m 25s"
  completed: "2026-01-26"
---

# Phase 04.3 Plan 02: Card Actions & Type Picker Summary

**One-liner:** Visual card type picker for hero/horizontal/square conversion, plus duplicate/delete actions with undo toast and header undo/redo buttons.

## What Was Built

### CardTypePicker Component
Created a 3-column grid of visual tiles for switching card types:
- Hero (RectangleHorizontal icon)
- Horizontal (Minus icon)
- Square (Square icon)

Selected tile shows `border-primary bg-primary/10` highlight. Only appears for convertible card types (not dropdown/video/gallery/game/audio).

### duplicateCard Store Action
Added to page-store.ts:
- Finds the original card
- Creates copy with new UUID, same content
- Generates sortKey to position AFTER original (using generateInsertKey)
- Selects the new card automatically

### Property Editor Actions
Added to card-property-editor.tsx:
- Card type picker section (before Image upload)
- Duplicate button with Copy icon
- Delete button (destructive variant) with Trash2 icon
- Delete shows toast with Undo action button (5 second duration)
- Clicking Undo restores card via history

### Header Undo/Redo Buttons
Added to dashboard-header.tsx:
- Undo2 and Redo2 icons in ghost button style
- Disabled when no history available (canUndo/canRedo)
- Tooltips show keyboard shortcuts (Ctrl+Z, Ctrl+Shift+Z)
- Visual separator between undo/redo and save section
- Toast feedback on click ("Undone" / "Redone")

## Key Technical Details

### Type Conversion
Switching card type only updates `card_type` field - all content (title, description, URL, image, content object) is preserved automatically since they share a unified schema.

### isConvertibleType Helper
Exported from card-type-picker.tsx to check if a card type supports conversion. Used to conditionally render the type picker.

### Undo Toast Pattern
```typescript
toast("Card deleted", {
  action: {
    label: "Undo",
    onClick: () => {
      undo()
      toast("Card restored")
    },
  },
  duration: 5000,
})
```

## Commits

| Hash | Description |
|------|-------------|
| 1156005 | feat(04.3-02): add CardTypePicker component and duplicateCard action |
| 2366c3c | feat(04.3-02): integrate type picker and actions into property editor |
| d1b6752 | feat(04.3-02): add undo/redo buttons to dashboard header |

## Deviations from Plan

None - plan executed exactly as written.

## Verification Checklist

- [x] CardTypePicker shows 3 tiles for hero/horizontal/square
- [x] Type picker only appears for convertible card types
- [x] Switching type preserves title, description, URL, image, content
- [x] duplicateCard action creates copy positioned after original
- [x] Duplicate selects the new card
- [x] Delete removes card immediately (no confirmation)
- [x] Delete shows toast with Undo action
- [x] Undo/Redo buttons in header with correct icons
- [x] Buttons disabled when not applicable
- [x] Tooltips show keyboard shortcuts
- [x] npm run build succeeds

## Next Phase Readiness

Phase 04.3 complete. Ready for:
- **04.4 Profile Editor**: May use similar action button patterns
- **04.5 Editor Polish (Mobile)**: Undo/redo buttons already touch-friendly (h-7 w-7)
